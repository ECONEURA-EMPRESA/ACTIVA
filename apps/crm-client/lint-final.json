[{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\@types\\i18next.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\ReloadPrompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\api\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\api\\mutations\\useSessionMutations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\api\\queries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\api\\queryKeys.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\api\\services.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\api\\services\\StatsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\auth\\LoginView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\auth\\useAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\layout\\PageTransition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\seo\\SeoHead.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\CommandMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\ConfirmationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\InvoiceGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\Loader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\MonthCalendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\OfflineIndicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\PatientAvatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\PaywallModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\PremiumSplash.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\components\\ui\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\context\\AuthContext.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":80,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":80,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\context\\ThemeContext.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":35,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":35,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\BillingRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\DocumentRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\GroupSessionRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\InvoiceRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\NoteRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\PatientRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\ReportRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\SessionRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\data\\repositories\\SettingsRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\analytics\\EvidenceChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\billing\\BillingView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\billing\\InvoiceGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\billing\\modals\\InvoiceWizardModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\billing\\modals\\InvoiceWizardModal.tsx:48:13\n  46 |         if (settings?.billing) {\n  47 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 48 |             setBillingData({\n     |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  49 |                 legalName: settings.billing.legalName || '',\n  50 |                 nif: settings.billing.nif || '',\n  51 |                 address: settings.billing.address || '',","line":48,"column":13,"nodeType":null,"endLine":48,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\billing\\modals\\InvoiceWizardModal.tsx:118:13\n  116 |             // Generate distinct default when opening\n  117 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 118 |             setCustomInvoiceNumber(`INV-${Date.now().toString().slice(-6)}`);\n      |             ^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  119 |         }\n  120 |     }, [isOpen]);\n  121 |","line":118,"column":13,"nodeType":null,"endLine":118,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\DashboardView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\components\\DailyNoteList.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\components\\DailyNoteList.tsx:16:9\n  14 |      \n  15 |     useEffect(() => {\n> 16 |         setText(item.text);\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  17 |     }, [item.text]);\n  18 |\n  19 |     const handleSave = () => {","line":16,"column":9,"nodeType":null,"endLine":16,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Save, Trash2, Check, Plus, StickyNote } from 'lucide-react';\nimport { NoteItem } from '../../../data/repositories/NoteRepository';\nimport { useNoteController } from '../../../hooks/controllers/useNoteController';\n\ninterface DailyNoteListProps {\n    dateStr: string;\n}\n\nconst NoteRow = ({ item, onUpdate, onDelete }: { item: NoteItem, onUpdate: (id: string, data: Partial<NoteItem>) => void, onDelete: (id: string) => void }) => {\n    const [isEditing, setIsEditing] = useState(false);\n    const [text, setText] = useState(item.text);\n\n     \n    useEffect(() => {\n        setText(item.text);\n    }, [item.text]);\n\n    const handleSave = () => {\n        if (text !== item.text) {\n            onUpdate(item.id, { text });\n        }\n        setIsEditing(false);\n    };\n\n    return (\n        <div className=\"group flex items-center gap-2 py-2 border-b border-slate-100 last:border-0\">\n            {/* Checkbox */}\n            <button\n                onClick={() => onUpdate(item.id, { isCompleted: !item.isCompleted })}\n                className={`shrink-0 w-4 h-4 rounded border flex items-center justify-center transition-all ${item.isCompleted ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-slate-300 hover:border-emerald-400'}`}\n            >\n                {item.isCompleted && <Check size={10} strokeWidth={4} />}\n            </button>\n\n            {/* Input */}\n            <div className=\"flex-1 min-w-0\">\n                <input\n                    className={`w-full bg-transparent text-sm outline-none transition-colors ${item.isCompleted ? 'text-slate-400 line-through' : 'text-slate-700'}`}\n                    value={text}\n                    onChange={(e) => {\n                        setText(e.target.value);\n                        setIsEditing(true);\n                    }}\n                    onBlur={handleSave}\n                    onKeyDown={(e) => {\n                        if (e.key === 'Enter') handleSave();\n                    }}\n                />\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex items-center gap-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity\">\n                {(isEditing || text !== item.text) && (\n                    <button onClick={handleSave} className=\"p-1 text-emerald-500 hover:bg-emerald-50 rounded\" title=\"Guardar\">\n                        <Save size={14} />\n                    </button>\n                )}\n                <button onClick={() => onDelete(item.id)} className=\"p-1 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded\" title=\"Eliminar\">\n                    <Trash2 size={14} />\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport const DailyNoteList: React.FC<DailyNoteListProps> = ({ dateStr }) => {\n    const { items, addItem, updateItem, deleteItem, isLoading } = useNoteController(dateStr);\n    // Note: getLoading might not exist in hook, checking hook signature. \n    // Hook returns: { items, addItem, updateItem, deleteItem, isLoading, isSaving... }\n\n    const [newItemText, setNewItemText] = useState('');\n\n    const handleAdd = () => {\n        if (!newItemText.trim()) return;\n        addItem(newItemText);\n        setNewItemText('');\n    };\n\n    return (\n        <div className=\"flex flex-col h-full\">\n            <div className=\"flex-1 overflow-y-auto custom-scrollbar\">\n                {isLoading ? (\n                    <div className=\"py-8 text-center text-xs text-slate-400\">Cargando notas...</div>\n                ) : items.length === 0 ? (\n                    <div className=\"py-8 text-center text-slate-300 flex flex-col items-center gap-2\">\n                        <StickyNote size={20} className=\"opacity-20\" />\n                        <span className=\"text-xs\">Sin notas</span>\n                    </div>\n                ) : (\n                    <div className=\"flex flex-col\">\n                        {items.map(item => (\n                            <NoteRow\n                                key={item.id}\n                                item={item}\n                                onUpdate={updateItem}\n                                onDelete={deleteItem}\n                            />\n                        ))}\n                    </div>\n                )}\n            </div>\n            {/* Add New Input */}\n            <form\n                onSubmit={(e) => {\n                    e.preventDefault();\n                    handleAdd();\n                }}\n                className=\"pt-3 mt-auto relative\"\n            >\n                <input\n                    className=\"w-full pl-3 pr-10 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:bg-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition-all\"\n                    placeholder=\"Nueva nota...\"\n                    value={newItemText}\n                    onChange={(e) => setNewItemText(e.target.value)}\n                    inputMode=\"text\"\n                    enterKeyHint=\"done\"\n                />\n                <button\n                    type=\"submit\"\n                    disabled={!newItemText.trim()}\n                    className=\"absolute right-1 top-4 p-1.5 bg-emerald-500 text-white rounded-md hover:bg-emerald-600 disabled:opacity-50 disabled:hover:bg-emerald-500 transition-colors shadow-sm\"\n                >\n                    <Plus size={14} />\n                </button>\n            </form>\n        </div>\n    );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\DailyAgendaWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11359,11362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11359,11362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":226,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":226,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":280,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":280,"endColumn":56}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\nimport { format, addDays, subDays, isSameDay, differenceInYears } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport {\n    ChevronLeft, ChevronRight, Calendar, User, Phone, Activity,\n    Search, Plus\n} from 'lucide-react';\n\nimport { Session, Patient } from '../../../lib/types';\nimport { Card } from '../../../components/ui/Card';\n\n\ntype ExtendedSession = Session & { patientId?: string | number; time?: string };\n\ninterface DailyAgendaWidgetProps {\n    sessions: ExtendedSession[];\n    patients: Patient[];\n    onSessionClick: (session: Session, patient?: Patient) => void;\n    selectedDate: Date;\n    onDateChange: (date: Date) => void;\n    onNewAppointment?: () => void;\n}\n\nexport const DailyAgendaWidget: React.FC<DailyAgendaWidgetProps> = ({\n    sessions,\n    patients,\n    onSessionClick,\n    selectedDate,\n    onDateChange,\n    onNewAppointment\n}) => {\n    // Helper for safe date parsing\n    const parseSafeDate = (dateVal: string | Date | undefined): Date => {\n        if (!dateVal) return new Date();\n        if (dateVal instanceof Date) return isNaN(dateVal.getTime()) ? new Date() : dateVal;\n\n        try {\n            if (typeof dateVal === 'string') {\n                if (dateVal.includes('/')) {\n                    const parts = dateVal.split('/');\n                    if (parts.length === 3) {\n                        const d = parseInt(parts[0], 10);\n                        const m = parseInt(parts[1], 10);\n                        const y = parseInt(parts[2], 10);\n                        if (!isNaN(d) && !isNaN(m) && !isNaN(y)) {\n                            return new Date(y, m - 1, d);\n                        }\n                    }\n                }\n                const parsed = new Date(dateVal);\n                return isNaN(parsed.getTime()) ? new Date() : parsed;\n            }\n        } catch {\n            return new Date();\n        }\n        return new Date();\n    };\n\n    // State for Search only (No more payment filters)\n    const [searchTerm, setSearchTerm] = useState('');\n    const [searchVisible, setSearchVisible] = useState(false);\n\n    // 1. Filter sessions for selected date\n    const dailySessions = useMemo(() => {\n        return sessions.filter(s => {\n            const sDate = parseSafeDate(s.date as string | undefined);\n            return isSameDay(sDate, selectedDate);\n        });\n    }, [sessions, selectedDate]);\n\n    // 2. Apply Search Filter\n    const filteredSessions = useMemo(() => {\n        return dailySessions.filter(session => {\n            const patient = patients.find(p => String(p.id) === String(session.patientId));\n            if (!patient) return false;\n\n            if (!searchTerm) return true;\n\n            return (\n                patient.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                (patient.contact && patient.contact.includes(searchTerm))\n            );\n        });\n    }, [dailySessions, searchTerm, patients]);\n\n    return (\n        <Card className=\"h-full flex flex-col bg-white border border-slate-100 shadow-xl shadow-slate-200/50 rounded-3xl overflow-hidden font-sans\">\n\n            {/* HERITAGE HEADER - Clean, White, Spacious */}\n            <div className=\"px-6 py-5 border-b border-slate-50 flex items-center justify-between bg-white sticky top-0 z-20\">\n                <button\n                    onClick={() => onDateChange(subDays(selectedDate, 1))}\n                    className=\"w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:bg-slate-100 hover:text-indigo-600 transition-all active:scale-95\"\n                >\n                    <ChevronLeft size={20} />\n                </button>\n\n                <div className=\"flex flex-col items-center\">\n                    <span className=\"text-[10px] font-black tracking-[0.2em] text-slate-400 uppercase mb-1\">\n                        AGENDA DIARIA\n                    </span>\n                    <h2 className=\"text-xl md:text-2xl font-bold text-slate-800 tracking-tight capitalize\">\n                        {(() => {\n                            try {\n                                return !isNaN(selectedDate.getTime()) ? format(selectedDate, \"EEEE d\", { locale: es }) : \"Agenda\";\n                            } catch { return \"Agenda\"; }\n                        })()}\n                        <span className=\"text-slate-300 font-light ml-2\">\n                            {(() => {\n                                try {\n                                    return !isNaN(selectedDate.getTime()) ? format(selectedDate, \"MMMM\", { locale: es }) : \"\";\n                                } catch { return \"\"; }\n                            })()}\n                        </span>\n                    </h2>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                    <button\n                        onClick={() => setSearchVisible(!searchVisible)}\n                        className={`w-10 h-10 flex items-center justify-center rounded-full transition-all active:scale-95 ${searchVisible ? 'bg-indigo-50 text-indigo-600' : 'bg-slate-50 text-slate-400 hover:bg-slate-100 hover:text-indigo-600'}`}\n                    >\n                        <Search size={18} />\n                    </button>\n                    {onNewAppointment && (\n                        <button\n                            onClick={onNewAppointment}\n                            className=\"w-10 h-10 flex items-center justify-center rounded-full bg-indigo-600 text-white shadow-md shadow-indigo-200 hover:bg-indigo-700 hover:shadow-lg transition-all active:scale-95\"\n                            title=\"Nueva Cita\"\n                        >\n                            <Plus size={20} />\n                        </button>\n                    )}\n                    <button\n                        onClick={() => onDateChange(addDays(selectedDate, 1))}\n                        className=\"w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:bg-slate-100 hover:text-indigo-600 transition-all active:scale-95\"\n                    >\n                        <ChevronRight size={20} />\n                    </button>\n                </div>\n            </div>\n\n            {/* SEARCH BAR (Expandable) */}\n            <div className={`overflow-hidden transition-all duration-300 ease-in-out ${searchVisible ? 'max-h-16 border-b border-slate-50' : 'max-h-0'}`}>\n                <div className=\"p-4 bg-slate-50/50\">\n                    <input\n                        autoFocus={searchVisible}\n                        className=\"w-full bg-white border-none rounded-xl py-3 px-4 text-sm font-medium focus:ring-2 focus:ring-indigo-100 text-slate-600 placeholder:text-slate-300 shadow-sm\"\n                        placeholder=\"Buscar paciente por nombre...\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                    />\n                </div>\n            </div>\n\n            {/* SPACIOUS LIST */}\n            <div className=\"flex-1 overflow-y-auto w-full custom-scrollbar bg-slate-50/30 p-4 md:p-6 space-y-4\">\n                {Object.keys(\n                    filteredSessions.reduce((acc, s) => {\n                        const pid = String(s.patientId);\n                        if (!acc[pid]) acc[pid] = [];\n                        acc[pid].push(s);\n                        return acc;\n                    }, {} as Record<string, typeof sessions>)\n                ).length === 0 ? (\n                    <div className=\"h-full flex flex-col items-center justify-center opacity-60\">\n                        <div className=\"w-24 h-24 rounded-full bg-slate-50 flex items-center justify-center mb-4\">\n                            <Calendar size={40} className=\"text-slate-200\" strokeWidth={1} />\n                        </div>\n                        <p className=\"text-slate-400 font-medium\">Sin citas programadas</p>\n                    </div>\n                ) : (\n                    Object.entries(\n                        filteredSessions.reduce((acc, s) => {\n                            const pid = String(s.patientId);\n                            if (!acc[pid]) acc[pid] = [];\n                            acc[pid].push(s);\n                            return acc;\n                        }, {} as Record<string, typeof sessions>)\n                    ).map(([patientId, patientSessions]) => {\n                        const patient = patients.find(p => String(p.id) === patientId);\n                        if (!patient) return null;\n\n                        // Sort sessions by time logic could go here if needed\n\n                        return (\n                            <button\n                                key={patientId}\n                                onClick={() => onSessionClick(patientSessions[0], patient)}\n                                className=\"group w-full bg-white rounded-2xl p-4 md:p-5 shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] hover:shadow-[0_8px_16px_-4px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 border border-slate-100/50 transition-all duration-300 flex items-center gap-5 relative overflow-hidden\"\n                            >\n                                {/* Decorative Gradient on Hover */}\n                                <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-indigo-500 to-purple-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n\n                                {/* 0. TIMES COLUMN (Grouped) */}\n                                <div className=\"flex flex-col items-center justify-center pr-4 border-r border-slate-100/50 min-w-[80px] py-1 gap-1\">\n                                    {patientSessions.map((s, idx) => {\n                                        // SAFE DATE PARSING (Titanium Fix - Robust)\n                                        let sessionDate = new Date();\n                                        try {\n                                            if (s.date && typeof s.date === 'string') {\n                                                if (s.date.includes('/')) {\n                                                    const parts = s.date.split('/');\n                                                    if (parts.length === 3) {\n                                                        const d = parseInt(parts[0], 10);\n                                                        const m = parseInt(parts[1], 10);\n                                                        const y = parseInt(parts[2], 10);\n                                                        if (!isNaN(d) && !isNaN(m) && !isNaN(y)) {\n                                                            sessionDate = new Date(y, m - 1, d);\n                                                        }\n                                                    }\n                                                } else {\n                                                    const parsed = new Date(s.date);\n                                                    if (!isNaN(parsed.getTime())) {\n                                                        sessionDate = parsed;\n                                                    }\n                                                }\n                                            } else if ((s.date as any) instanceof Date) {\n                                                sessionDate = s.date as unknown as Date;\n                                            }\n\n                                            // Final Safety Check\n                                            if (isNaN(sessionDate.getTime())) {\n                                                sessionDate = new Date();\n                                            }\n                                        } catch (_e) {\n                                            sessionDate = new Date();\n                                        }\n\n                                        return (\n                                            <div key={idx} className=\"flex flex-col items-center\">\n                                                <span className=\"text-xl md:text-2xl font-black text-slate-700 tracking-tight group-hover:text-indigo-600 transition-colors\">\n                                                    {s.time || '10:00'}\n                                                </span>\n                                                {idx === 0 && (\n                                                    <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none mt-0.5\">\n                                                        {format(sessionDate, 'd MMM', { locale: es })}\n                                                    </span>\n                                                )}\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n\n                                {/* 1. PHOTO (Elevated) */}\n                                <div className=\"shrink-0 relative\">\n                                    <div className=\"w-14 h-14 md:w-16 md:h-16 rounded-2xl overflow-hidden shadow-sm ring-4 ring-slate-50 group-hover:ring-indigo-50 transition-all\">\n                                        {patient.photo ? (\n                                            <img\n                                                src={patient.photo}\n                                                alt={patient.name}\n                                                className=\"w-full h-full object-cover\"\n                                            />\n                                        ) : (\n                                            <div className=\"w-full h-full bg-slate-100 flex items-center justify-center text-slate-300\">\n                                                <User size={24} strokeWidth={1.5} />\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n\n                                {/* 2. INFO BLOCK */}\n                                <div className=\"flex-1 min-w-0 flex flex-col items-start gap-1\">\n                                    <div className=\"flex items-center gap-2 w-full mb-1\">\n                                        <h3 className=\"text-base md:text-lg font-bold text-slate-800 leading-tight group-hover:text-indigo-700 transition-colors\">\n                                            {patient.name}\n                                        </h3>\n                                        {(() => {\n                                            try {\n                                                if (patient.birthDate) {\n                                                    const bDate = new Date(patient.birthDate);\n                                                    if (!isNaN(bDate.getTime())) {\n                                                        return (\n                                                            <span className=\"shrink-0 inline-flex items-center justify-center px-2 py-0.5 rounded-md bg-indigo-50 text-indigo-600 text-[10px] font-bold uppercase tracking-wider\">\n                                                                {differenceInYears(new Date(), bDate)} AÃ‘OS\n                                                            </span>\n                                                        );\n                                                    }\n                                                }\n                                            } catch (_e) { return null; }\n                                            return null;\n                                        })()}\n                                    </div>\n\n                                    <div className=\"flex items-center gap-3 w-full\">\n                                        {/* Diagnosis Badge */}\n                                        <div className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-slate-100/80 text-slate-500 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors\">\n                                            <Activity size={12} strokeWidth={2} />\n                                            <span className=\"text-[11px] font-bold uppercase tracking-wide truncate max-w-[150px]\">\n                                                {patient.diagnosis || 'General'}\n                                            </span>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* 3. PHONE (Subtle, right aligned) */}\n                                <div className=\"hidden sm:flex flex-col items-end gap-1 text-slate-400\">\n                                    <button\n                                        onClick={(evt) => {\n                                            evt.stopPropagation();\n                                            if (patient.contact) {\n                                                window.location.href = `tel:${patient.contact.replace(/\\s/g, '')}`;\n                                            }\n                                        }}\n                                        className=\"w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center hover:bg-slate-200 hover:text-slate-800 transition-colors z-10\"\n                                        title=\"Llamar\"\n                                    >\n                                        <Phone size={14} />\n                                    </button>\n                                    <span className=\"text-[10px] font-medium opacity-0 group-hover:opacity-100 transition-opacity\">\n                                        {patient.contact}\n                                    </span>\n                                </div>\n\n                                {/* Arrow Hint */}\n                                <div className=\"text-slate-200 group-hover:translate-x-1 transition-transform\">\n                                    <ChevronRight size={20} />\n                                </div>\n                            </button>\n                        );\n                    })\n                )}\n            </div>\n        </Card>\n    );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\KPICard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\PostItWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\RecentActivity.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\StatsCards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\SystemActivity.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":61,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card } from '../../../components/ui/Card';\nimport { Activity, UserPlus, Settings2, CalendarCheck, FileSignature, CreditCard, ShieldCheck, FileX, Loader2 } from 'lucide-react';\nimport { ActivityLogItem } from '../../../hooks/useActivityLog';\nimport { formatDistanceToNow } from 'date-fns';\nimport { es } from 'date-fns/locale';\n\ninterface SystemActivityProps {\n    activities: ActivityLogItem[];\n    isLoading?: boolean;\n}\n\nexport const SystemActivity: React.FC<SystemActivityProps> = ({ activities, isLoading }) => {\n    const getIcon = (type: string) => {\n        switch (type) {\n            case 'patient': return <UserPlus size={16} className=\"text-emerald-600\" />;\n            case 'settings': return <Settings2 size={16} className=\"text-slate-600\" />;\n            case 'session': return <CalendarCheck size={16} className=\"text-pink-600\" />;\n            case 'report': return <FileSignature size={16} className=\"text-purple-600\" />; // Premium Doc\n            case 'finance': return <CreditCard size={16} className=\"text-amber-600\" />; // Premium Pay\n            case 'security': return <ShieldCheck size={16} className=\"text-indigo-600\" />; // Premium Sec\n            case 'delete': return <FileX size={16} className=\"text-red-500\" />; // Premium Void\n            default: return <Activity size={16} className=\"text-blue-600\" />;\n        }\n    };\n\n    return (\n        <Card className=\"p-6 h-full flex flex-col\">\n            <div className=\"flex justify-between items-center mb-6\">\n                <h3 className=\"font-bold text-lg text-slate-800 flex items-center gap-2\">\n                    <Activity className=\"text-indigo-500\" /> Registro de Actividad\n                </h3>\n            </div>\n\n            <div className=\"space-y-4 flex-1\">\n                {isLoading ? (\n                    <div className=\"flex justify-center py-8\">\n                        <Loader2 className=\"animate-spin text-indigo-500\" size={24} />\n                    </div>\n                ) : activities.length === 0 ? (\n                    <div className=\"text-center py-8 text-slate-400 text-sm\">\n                        Sin actividad registrada aÃºn.\n                    </div>\n                ) : (\n                    activities.map((item) => (\n                        <div key={item.id} className=\"flex gap-4 items-start pb-4 border-b border-slate-50 last:border-0 last:pb-0\">\n                            <div className=\"mt-1 p-2 bg-slate-50 rounded-lg shrink-0\">\n                                {getIcon(item.type)}\n                            </div>\n                            <div>\n                                <p className=\"text-sm font-bold text-slate-800 leading-tight\">\n                                    {item.message}\n                                </p>\n                                <p className=\"text-xs text-slate-400 mt-1\">\n                                    {(() => {\n                                        try {\n                                            const d = new Date(item.timestamp);\n                                            return !isNaN(d.getTime())\n                                                ? formatDistanceToNow(d, { addSuffix: true, locale: es })\n                                                : \"Hace un momento\";\n                                        } catch (e) {\n                                            return \"Hace un momento\";\n                                        }\n                                    })()}\n                                </p>\n                            </div>\n                        </div>\n                    ))\n                )}\n            </div>\n        </Card>\n    );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\dashboard\\widgets\\WeeklyAgendaWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\GroupDetailView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\GroupsDirectory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\PatientDetail.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has an unnecessary dependency: 'patient.diagnosis'. Either exclude it or remove the dependency array. Outer scope values like 'patient.diagnosis' aren't valid dependencies because mutating them doesn't re-render the component.","line":291,"column":12,"nodeType":"ArrayExpression","endLine":291,"endColumn":69,"suggestions":[{"desc":"Update the dependencies array to be: [initialData, fieldKey, normalizeData]","fix":{"range":[13001,13058],"text":"[initialData, fieldKey, normalizeData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport {\n    Activity,\n    BarChart3,\n    ClipboardCheck,\n    DollarSign,\n    ArrowLeft,\n    Lightbulb,\n    FileText,\n    Trash2,\n    Edit,\n    PlusCircle,\n    PenTool,\n    CheckSquare,\n    ShieldCheck,\n    Music,\n    Folder,\n    Save,\n    Phone,\n    CalendarPlus,\n} from 'lucide-react';\nimport { useCreateSession, useUpdateSession, useDeleteSession } from '../../api/mutations/useSessionMutations';\nimport { Button } from '../../components/ui/Button';\nimport { Card } from '../../components/ui/Card';\nimport { Badge } from '../../components/ui/Badge';\nimport { PatientAvatar } from '../../components/ui/PatientAvatar';\nimport { Toast } from '../../components/ui/Toast';\nimport { InvoiceGenerator } from '../../components/ui/InvoiceGenerator';\nimport { DocumentsTab } from './tabs/DocumentsTab';\nimport { PhaseProgress } from './components/PhaseProgress';\n\n// Modals\nimport { EditProfileModal } from './modals/EditProfileModal';\nimport { AdmissionChecklistModal } from './modals/AdmissionChecklistModal';\nimport { SafetyModal } from './modals/SafetyModal'; // NEW\nimport { MusicalIdentityModal } from './modals/MusicalIdentityModal'; // NEW\nimport { CognitiveModal } from './modals/CognitiveModal';\nimport { SessionModal } from './modals/SessionModal';\nimport { ClinicalGuideModal } from './modals/ClinicalGuideModal';\nimport { ReportModal } from './modals/ReportModal';\n\nimport { TREATMENT_PHASES, getPhaseForSessionIndex } from '../../lib/clinicalUtils';\nimport { FORMULATION_OPTIONS, PATHOLOGY_MAP, MOBILITY_MAP } from '../../lib/patientUtils';\n\nimport { Patient, Session, FormulationData, ClinicalFormulation, InvoiceData, ClinicalSafetyProfile as SafetyProfile, MusicalIdentity, CognitiveScores } from '../../lib/types';\n\nconst RISK_LABELS: Record<string, string> = {\n    epilepsy: 'Epilepsia',\n    dysphagia: 'Disfagia',\n    flightRisk: 'Riesgo Fuga',\n    psychomotorAgitation: 'AgitaciÃ³n',\n    hyperacusis: 'Hiperacusia',\n    chokingHazard: 'Riesgo Atragantamiento',\n    disruptiveBehavior: 'Conducta Disruptiva',\n};\n\nimport { useAuth } from '../../context/AuthContext';\nimport { EvidenceChart } from '../analytics/EvidenceChart';\nimport { PaywallModal } from '../../components/ui/PaywallModal';\nimport { useActivityLog } from '../../hooks/useActivityLog';\nimport { useDeletePatient } from '../../api/queries';\nimport { ConfirmationModal } from '../../components/ui/ConfirmationModal';\nimport { useSettingsController } from '../../hooks/controllers/useSettingsController';\n\ninterface PatientDetailProps {\n    patient: Patient;\n    onBack: () => void;\n    onUpdate: (updated: Patient) => void;\n}\n\nexport const PatientDetail: React.FC<PatientDetailProps> = ({\n    patient,\n    onBack,\n    onUpdate,\n}) => {\n    const { settings: clinicSettings } = useSettingsController();\n    const { logActivity } = useActivityLog();\n    const { canDelete, canViewFinancials, isPremium, demoMode } = useAuth();\n    const [showPaywall, setShowPaywall] = useState(false);\n    const [showDeleteModal, setShowDeleteModal] = useState(false);\n\n    // Deletion Hook\n    const { mutate: deletePatient, isPending: isDeleting } = useDeletePatient(demoMode);\n\n    const confirmDelete = () => {\n        if (!patient.id) return;\n        deletePatient(String(patient.id), {\n            onSuccess: () => {\n                logActivity('delete', `Paciente eliminado permanentemente: ${patient.name}`);\n                setShowDeleteModal(false);\n                showToast('Paciente eliminado correctamente', 'success');\n                onBack(); // Return to directory\n            },\n            onError: (err: unknown) => {\n                console.error(err);\n                setShowDeleteModal(false);\n                showToast('Error al eliminar paciente', 'error');\n            }\n        });\n    };\n    const [notification, setNotification] = useState<{\n        msg: string;\n        type: 'success' | 'error';\n    } | null>(null);\n    const showToast = (msg: string, type: 'success' | 'error' = 'success') => {\n        setNotification({ msg, type });\n    };\n\n    // ROBUST: cleanup timeout on unmount or change\n    useEffect(() => {\n        if (notification) {\n            const timer = setTimeout(() => setNotification(null), 3000);\n            return () => clearTimeout(timer);\n        }\n    }, [notification]);\n\n    // Modal State\n    const [showSessionModal, setShowSessionModal] = useState(false);\n    const [selectedSession, setSelectedSession] = useState<Session | undefined>(undefined);\n    const [showCognitiveModal, setShowCognitiveModal] = useState(false);\n    const [cognitiveInitialTab, setCognitiveInitialTab] = useState<'general' | 'moca' | 'mmse'>('general');\n    const [showGuideModal, setShowGuideModal] = useState(false);\n    const [showEditProfile, setShowEditProfile] = useState(false);\n    const [showInvoice, setShowInvoice] = useState(false);\n    const [showReportModal, setShowReportModal] = useState(false);\n    const [showAdmissionChecklist, setShowAdmissionChecklist] = useState(false);\n\n    // NEW MODAL STATES\n    const [showSafetyModal, setShowSafetyModal] = useState(false);\n    const [showIsoModal, setShowIsoModal] = useState(false);\n\n    const [invoiceData, setInvoiceData] = useState<InvoiceData | null>(null);\n\n    const tabs = [\n        { id: 'treatment', label: 'Plan de Tratamiento', icon: Activity }, // UNIFIED TAB\n        { id: 'evaluation', label: 'EvaluaciÃ³n (0-3)', icon: BarChart3 },\n        { id: 'sessions', label: 'BitÃ¡cora', icon: ClipboardCheck },\n        { id: 'documents', label: 'Gestor Documental', icon: Folder },\n        ...(canViewFinancials ? [{ id: 'billing', label: 'FacturaciÃ³n', icon: DollarSign }] : []),\n        { id: 'discharge', label: 'Alta y Continuidad', icon: CheckSquare },\n    ];\n\n    const isChild = patient.age < 15;\n\n    const validSessions = patient.sessions ? patient.sessions.filter((s) => !s.isAbsent) : [];\n    const currentPhase =\n        TREATMENT_PHASES.find((p) => {\n            const parts = p.range.split('-');\n            const min = parseInt(parts[0]);\n            const max = parseInt(parts[1]);\n            return validSessions.length >= min && validSessions.length <= max;\n        }) || TREATMENT_PHASES[0];\n\n    const [activeTab, setActiveTab] = useState('treatment');\n\n    // TITANIUM MUTATIONS\n    const { mutateAsync: createSession } = useCreateSession();\n    const { mutateAsync: updateSession } = useUpdateSession();\n    const { mutateAsync: deleteSession } = useDeleteSession();\n\n    const handleDeleteSession = async (sessionId: string | number) => {\n        // Confirmation is handled in the Modal\n        try {\n            if (patient.id) {\n                await deleteSession({ patientId: String(patient.id), sessionId: String(sessionId) });\n                logActivity('session', `SesiÃ³n eliminada de historial: ${patient.name}`);\n                showToast('SesiÃ³n eliminada del historial', 'success');\n                setShowSessionModal(false);\n            } else {\n                console.error('Titanium Error: Patient ID missing');\n            }\n        } catch (e) {\n            console.error('Delete Error:', e);\n            showToast('Error al eliminar', 'error');\n        }\n    };\n\n    const handleSaveSession = async (sessionData: Session | Partial<Session>) => {\n        const isNew = !selectedSession;\n\n        try {\n            if (isNew) {\n                if (patient.id) {\n                    await createSession({ patientId: String(patient.id), session: sessionData as Session });\n\n                    if (sessionData.isAbsent) {\n                        logActivity('session', `Ausencia registrada por ${patient.name}`);\n                    } else {\n                        logActivity('session', `SesiÃ³n completada con ${patient.name}`);\n                    }\n                }\n            } else {\n                if (patient.id && sessionData.id) {\n                    await updateSession({ patientId: String(patient.id), sessionId: String(sessionData.id), data: sessionData });\n\n                    if (sessionData.paid) {\n                        logActivity('finance', `Pago registrado: SesiÃ³n de ${patient.name}`);\n                    } else if (sessionData.isAbsent) {\n                        logActivity('session', `SesiÃ³n marcada como AUSENCIA: ${patient.name}`);\n                    } else {\n                        logActivity('session', `SesiÃ³n actualizada: ${patient.name}`);\n                    }\n                }\n            }\n            setShowSessionModal(false);\n            showToast('SesiÃ³n guardada correctamente', 'success');\n        } catch (e) {\n            console.error('Save Error:', e);\n            showToast('Error al guardar sesiÃ³n', 'error');\n        }\n    };\n\n    // Sort sessions descending (Newest first)\n    // HELPER: Robust Date Parsing\n    const parseSessionDate = (dStr: string) => {\n        if (!dStr) return 0;\n        if (dStr.includes('/')) {\n            const [d, m, y] = dStr.split('/');\n            return new Date(`${y}-${m}-${d}`).getTime();\n        }\n        return new Date(dStr).getTime();\n    };\n\n    const activeSessions = React.useMemo(() => {\n        return [...(patient.sessions || [])].sort((a, b) => {\n            return parseSessionDate(b.date) - parseSessionDate(a.date);\n        });\n    }, [patient.sessions]);\n\n    // Calculate phases considering only valid (non-absent) sessions\n    const sessionPhaseMap = React.useMemo(() => {\n        const map: Record<string, number> = {};\n        let validCount = 0;\n        // Process chronologically (Oldest -> Newest)\n        [...activeSessions].reverse().forEach((s) => {\n            if (!s.isAbsent) {\n                validCount++;\n                map[s.id] = getPhaseForSessionIndex(validCount - 1);\n            }\n        });\n        return map;\n    }, [activeSessions]);\n\n    interface FormulationSectionProps {\n        title: string;\n        optionsKey: keyof typeof FORMULATION_OPTIONS;\n        fieldKey: keyof ClinicalFormulation;\n        initialData: FormulationData | string | undefined;\n        onSave: (fieldKey: keyof ClinicalFormulation, data: FormulationData) => void;\n    }\n\n    const FormulationSection: React.FC<FormulationSectionProps> = ({ title, optionsKey, fieldKey, initialData, onSave }) => {\n        const isFormulationData = React.useCallback((val: unknown): val is FormulationData => {\n            return typeof val === 'object' && val !== null && 'selected' in val;\n        }, []);\n\n        const normalizeData = React.useCallback((val: unknown): FormulationData => {\n            return isFormulationData(val)\n                ? val\n                : { selected: [], text: typeof val === 'string' ? val : '' };\n        }, [isFormulationData]);\n\n        const [localData, setLocalData] = useState<FormulationData>(normalizeData(initialData));\n        const [isDirty, setIsDirty] = useState(false);\n\n        useEffect(() => {\n            const data = normalizeData(initialData);\n            if (!data.text && patient.diagnosis) {\n                let template = '';\n                if (fieldKey === 'synthesis') {\n                    template = `Paciente de ${patient.age} aÃ±os con diagnÃ³stico principal de ${patient.diagnosis}.` +\n                        (patient.pathologyType ? ` Se clasifica dentro del espectro: ${PATHOLOGY_MAP[patient.pathologyType] || patient.pathologyType}.` : '');\n                } else if (fieldKey === 'hypothesis') {\n                    template = `Se propone intervenciÃ³n musicoterapÃ©utica centrada en ${patient.diagnosis.toLowerCase().includes('demencia') ? 'estimulaciÃ³n cognitiva y reminiscencia' : 'regulaciÃ³n emocional y expresiÃ³n'}.`;\n                } else if (fieldKey === 'objectives') {\n                    // AUTO-OBJECTIVES LOGIC\n                    if (patient.diagnosis.toLowerCase().includes('alzheimer') || patient.diagnosis.toLowerCase().includes('demencia')) {\n                        template = \"1. Mantenimiento de funciones cognitivas (atenciÃ³n, memoria).\\n2. ReducciÃ³n de sintomatologÃ­a conductual y ansiÃ³gena.\\n3. Fomento de la conexiÃ³n con el entorno y la identidad sonora.\\n4. EstimulaciÃ³n de la memoria autobiogrÃ¡fica a travÃ©s de la reminiscencia musical.\";\n                    } else if (patient.age < 18) {\n                        template = \"1. Fomentar la expresiÃ³n emocional y la comunicaciÃ³n no verbal.\\n2. Mejorar la atenciÃ³n conjunta y la interacciÃ³n social.\\n3. Desarrollo de habilidades motrices y rÃ­tmicas.\\n4. RegulaciÃ³n sensorial y conductual.\";\n                    } else {\n                        template = \"1. Mejorar el bienestar emocional y la autopercepciÃ³n.\\n2. Facilitar la expresiÃ³n de sentimientos bloqueados.\\n3. Promover la relajaciÃ³n y reducciÃ³n de estrÃ©s.\\n4. Potenciar recursos creativos y de afrontamiento.\";\n                    }\n                }\n                if (template) {\n                    data.text = template;\n                    setIsDirty(true);\n                }\n            }\n            setLocalData(data);\n        }, [initialData, fieldKey, patient.diagnosis, normalizeData]);\n\n        const handleCheck = (option: string) => {\n            const newSelected = localData.selected.includes(option)\n                ? localData.selected.filter((s) => s !== option)\n                : [...localData.selected, option];\n            setLocalData({ ...localData, selected: newSelected });\n            setIsDirty(true);\n        };\n\n        const handleText = (text: string) => {\n            setLocalData({ ...localData, text });\n            setIsDirty(true);\n        };\n\n        const handleSaveClick = () => {\n            onSave(fieldKey, localData);\n            setIsDirty(false);\n        };\n\n        return (\n            <div className=\"bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col h-full\">\n                <h4 className=\"font-bold text-slate-700 text-sm uppercase tracking-wide mb-3 flex items-center gap-2\">\n                    <CheckSquare size={16} className=\"text-pink-600\" /> {title}\n                </h4>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-4\">\n                    {(FORMULATION_OPTIONS[optionsKey] || []).map((opt: string) => (\n                        <label\n                            key={opt}\n                            className=\"flex items-start gap-2 text-sm text-slate-600 cursor-pointer hover:bg-slate-50 p-1.5 rounded transition-colors border border-transparent hover:border-slate-100\"\n                        >\n                            <input\n                                type=\"checkbox\"\n                                className=\"mt-0.5 accent-pink-600 w-4 h-4\"\n                                checked={localData.selected.includes(opt)}\n                                onChange={() => handleCheck(opt)}\n                            />\n                            <span className=\"leading-snug select-none\">{opt}</span>\n                        </label>\n                    ))}\n                </div>\n                <textarea\n                    className=\"input-pro text-sm h-32 resize-none bg-slate-50 border-slate-200 focus:bg-white mb-4\"\n                    placeholder=\"Detalles clÃ­nicos y observaciones...\"\n                    value={localData.text}\n                    onChange={(e) => handleText(e.target.value)}\n                />\n                <div className=\"mt-auto flex justify-end\">\n                    <Button\n                        size=\"sm\"\n                        variant={isDirty ? 'primary' : 'secondary'}\n                        onClick={handleSaveClick}\n                        icon={Save}\n                        disabled={!isDirty}\n                    >\n                        {isDirty ? 'Guardar Cambios' : 'Actualizado'}\n                    </Button>\n                </div>\n            </div>\n        );\n    };\n\n    const handlePrintGlobalInvoice = () => {\n        // INCLUIR TODAS LAS SESIONES REALIZADAS (PAGADAS O NO)\n        // Se excluyen ausencias SOLO si no tienen precio (no cobradas)\n        const allBillableSessions = activeSessions\n            .filter((s) => !s.isAbsent || (s.price && s.price > 0))\n            .sort((a, b) => {\n                // Sort Chronologically for Invoice (Oldest -> Newest)\n                const timeA = parseSessionDate(a.date);\n                const timeB = parseSessionDate(b.date);\n                return timeA - timeB;\n            });\n\n\n\n        if (allBillableSessions.length === 0)\n            return alert('No se encontraron sesiones para facturar.');\n\n        // Generate sequential invoice number roughly or use default\n        const defaultNum = `FACT-${Date.now().toString().slice(-6)}`;\n        setInvoiceData({\n            clientName: patient.name,\n            clientMeta: `Paciente Ref: ${patient.reference || '-'}`,\n            sessions: allBillableSessions,\n            invoiceNumber: defaultNum,\n        });\n        setShowInvoice(true);\n    };\n\n    const highRisks = patient.safetyProfile\n        ? Object.entries(patient.safetyProfile)\n            .filter(\n                ([k, v]) =>\n                    v === true &&\n                    [\n                        'epilepsy',\n                        'dysphagia',\n                        'flightRisk',\n                        'psychomotorAgitation',\n                        'chokingHazard',\n                    ].includes(k),\n            )\n            .map(([k]) => k)\n        : [];\n\n    const isoNocivo = patient.musicalIdentity?.dislikes?.length || 0;\n\n    return (\n        <div className=\"space-y-6 animate-in slide-in-from-right-4 duration-300 max-w-7xl mx-auto\">\n            {notification && (\n                <Toast\n                    message={notification.msg}\n                    type={notification.type}\n                    onClose={() => setNotification(null)}\n                />\n            )}\n\n            {/* --- MODALS --- */}\n\n            {showSafetyModal && (\n                <SafetyModal\n                    onClose={() => setShowSafetyModal(false)}\n                    isChild={isChild}\n                    initialData={patient.safetyProfile || undefined}\n                    onSave={(data) => {\n                        onUpdate({ ...patient, safetyProfile: data as SafetyProfile });\n                        logActivity('security', `Seguridad ClÃ­nica actualizada: ${patient.name}`);\n                        setShowSafetyModal(false);\n                        showToast('Protocolo de Seguridad Actualizado', 'success');\n                    }}\n                />\n            )}\n\n            {showIsoModal && (\n                <MusicalIdentityModal\n                    onClose={() => setShowIsoModal(false)}\n                    initialData={patient.musicalIdentity || undefined}\n                    onSave={(data) => {\n                        onUpdate({ ...patient, musicalIdentity: data as MusicalIdentity });\n                        logActivity('security', `Identidad Sonora (ISO) actualizada: ${patient.name}`);\n                        setShowIsoModal(false);\n                        showToast('ISO Actualizado', 'success');\n                    }}\n                />\n            )}\n\n            {showSessionModal && (\n                <SessionModal\n                    initialData={selectedSession as Session} // Cast to Session\n                    patientType={patient.pathologyType || 'other'}\n                    onClose={() => setShowSessionModal(false)}\n                    onSave={handleSaveSession}\n                    onDelete={handleDeleteSession}\n                />\n            )}\n            {showCognitiveModal && (\n                <CognitiveModal\n                    onClose={() => {\n                        setShowCognitiveModal(false);\n                        setCognitiveInitialTab('general');\n                    }}\n                    onSave={(data) => {\n                        const d = data as CognitiveScores & { functionalScores?: number[] };\n                        onUpdate({\n                            ...patient,\n                            cognitiveScores: { ...patient.cognitiveScores, ...data },\n                            currentEval: d.functionalScores,\n                        });\n                        setShowCognitiveModal(false);\n                        setCognitiveInitialTab('general');\n                        showToast('EvaluaciÃ³n actualizada', 'success');\n                    }}\n                    initialData={patient.cognitiveScores}\n                    initialScores={patient.currentEval}\n                    initialTab={cognitiveInitialTab}\n                    isChild={isChild}\n                    isGeriatric={patient.age >= 60}\n                />\n            )}\n            {showGuideModal && <ClinicalGuideModal onClose={() => setShowGuideModal(false)} />}\n            {showEditProfile && (\n                <EditProfileModal\n                    onClose={() => setShowEditProfile(false)}\n                    onSave={(data) => {\n                        onUpdate({ ...patient, ...data });\n                        setShowEditProfile(false);\n                        showToast('Perfil actualizado', 'success');\n                    }}\n                    initialData={patient}\n                />\n            )}\n            {showInvoice && invoiceData && (\n                <InvoiceGenerator\n                    data={invoiceData}\n                    onClose={() => setShowInvoice(false)}\n                    clinicSettings={clinicSettings || {}}\n                />\n            )}\n            {showReportModal && (\n                <ReportModal\n                    isOpen={showReportModal}\n                    onClose={() => setShowReportModal(false)}\n                    patient={patient}\n                    clinicSettings={clinicSettings || {}}\n                />\n            )}\n            {showAdmissionChecklist && (\n                <AdmissionChecklistModal\n                    onClose={() => setShowAdmissionChecklist(false)}\n                    onSave={(data) => {\n                        onUpdate({\n                            ...patient,\n                            cognitiveScores: { ...patient.cognitiveScores, admissionChecks: data },\n                        });\n                        setShowAdmissionChecklist(false);\n                        showToast('Checklist guardado', 'success');\n                    }}\n                    initialData={patient.cognitiveScores?.admissionChecks}\n                    isChild={isChild}\n                />\n            )}\n\n            <PaywallModal\n                isOpen={showPaywall}\n                onClose={() => setShowPaywall(false)}\n                limitType=\"session\"\n            />\n\n            {/* --- CRITICAL ALERTS BANNER --- */}\n            {(highRisks.length > 0 || isoNocivo > 0) && (\n                <div className=\"bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg shadow-sm flex flex-col md:flex-row items-start md:items-center gap-4\">\n                    <div className=\"flex items-start gap-4 w-full md:w-auto\">\n                        <div className=\"p-2 bg-red-100 rounded-full text-red-600 shrink-0\">\n                            <ShieldCheck size={24} />\n                        </div>\n                        <div className=\"flex-1\">\n                            <h3 className=\"font-bold text-red-800 flex items-center gap-2 text-sm md:text-base\">\n                                ALERTA DE SEGURIDAD CLÃNICA\n                            </h3>\n                            <div className=\"mt-1 flex flex-wrap gap-2\">\n                                {highRisks.includes('epilepsy') && (\n                                    <span className=\"px-2 py-0.5 bg-red-200 text-red-800 text-[10px] md:text-xs font-bold rounded\">\n                                        EPILEPSIA\n                                    </span>\n                                )}\n                                {highRisks.includes('dysphagia') && (\n                                    <span className=\"px-2 py-0.5 bg-red-200 text-red-800 text-[10px] md:text-xs font-bold rounded\">\n                                        DISFAGIA\n                                    </span>\n                                )}\n                                {highRisks.includes('flightRisk') && (\n                                    <span className=\"px-2 py-0.5 bg-red-200 text-red-800 text-[10px] md:text-xs font-bold rounded\">\n                                        RIESGO FUGA\n                                    </span>\n                                )}\n                                {highRisks.includes('psychomotorAgitation') && (\n                                    <span className=\"px-2 py-0.5 bg-red-200 text-red-800 text-[10px] md:text-xs font-bold rounded\">\n                                        AGITACIÃ“N\n                                    </span>\n                                )}\n                                {isoNocivo > 0 && (\n                                    <span className=\"px-2 py-0.5 bg-orange-200 text-orange-800 text-[10px] md:text-xs font-bold rounded\">\n                                        ISO NOCIVO ACTIVO\n                                    </span>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n                <button\n                    className=\"flex items-center gap-2 text-slate-500 font-bold text-sm hover:text-slate-800 transition-colors\"\n                    onClick={onBack}\n                >\n                    <ArrowLeft size={18} /> Volver al Directorio\n                </button>\n                <div className=\"flex gap-2 flex-wrap\">\n                    <Button\n                        variant=\"primary\"\n                        size=\"sm\"\n                        icon={CalendarPlus}\n                        className=\"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-200\"\n                        onClick={() => {\n                            setSelectedSession(undefined);\n                            setShowSessionModal(true);\n                        }}\n                    >\n                        AGENDAR CITA\n                    </Button>\n\n                    <Button\n                        variant=\"secondary\"\n                        size=\"sm\"\n                        icon={FileText}\n                        onClick={() => setShowReportModal(true)}\n                    >\n                        Informe\n                    </Button>\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        icon={Lightbulb}\n                        onClick={() => setShowGuideModal(true)}\n                    >\n                        GuÃ­a\n                    </Button>\n                    <Button\n                        variant=\"primary\"\n                        size=\"sm\"\n                        className=\"bg-emerald-500 hover:bg-emerald-600 text-white border-emerald-600\"\n                        icon={Phone}\n                        onClick={() => {\n                            const targetPhone = patient.contact || patient.caregiverPhone;\n                            if (targetPhone) {\n                                window.location.href = `tel:${targetPhone.replace(/\\s/g, '')}`;\n                                logActivity('system', `Llamada iniciada con ${patient.name}`);\n                            } else {\n                                showToast('No hay telÃ©fono registrado', 'error');\n                            }\n                        }}\n                    >\n                        Llamar\n                    </Button>\n                    {canDelete && (\n                        <Button\n                            variant=\"danger\"\n                            size=\"sm\"\n                            icon={Trash2}\n                            onClick={() => setShowDeleteModal(true)}\n                            disabled={isDeleting}\n                        >\n                            Eliminar Paciente\n                        </Button>\n                    )}\n                </div>\n            </div>\n\n            <ConfirmationModal\n                isOpen={showDeleteModal}\n                onClose={() => setShowDeleteModal(false)}\n                onConfirm={confirmDelete}\n                title=\"Â¿Eliminar Paciente?\"\n                message={`Esta acciÃ³n eliminarÃ¡ permanentemente a ${patient.name} y todo su historial clÃ­nico, sesiones y documentos. Esta acciÃ³n NO se puede deshacer.`}\n                confirmLabel={isDeleting ? 'Eliminando...' : 'SÃ­, Eliminar Definitivamente'}\n                isLoading={isDeleting}\n            />\n            <Card noPadding className=\"overflow-hidden\">\n                <div className=\"h-24 bg-gradient-to-r from-slate-800 to-slate-900\"></div>\n                <div className=\"px-4 md:px-8 pb-8\">\n                    <div className=\"flex flex-col md:flex-row gap-4 md:gap-6 items-center md:items-end -mt-10 text-center md:text-left\">\n                        <div className=\"relative\">\n                            <div className=\"p-1.5 bg-white rounded-full\">\n                                <PatientAvatar photo={patient.photo} name={patient.name} size=\"xl\" />\n                            </div>\n                        </div>\n                        <div className=\"flex-1 pb-2\">\n                            <h1 className=\"text-3xl font-bold text-slate-900 flex items-center gap-3\">\n                                {patient.name}\n                                <button\n                                    onClick={() => setShowEditProfile(true)}\n                                    className=\"text-slate-400 hover:text-pink-600 transition-colors\"\n                                >\n                                    <Edit size={20} />\n                                </button>\n                            </h1>\n                            <p className=\"text-slate-500 font-medium\">{PATHOLOGY_MAP[patient.diagnosis] || patient.diagnosis}</p>\n                        </div>\n                        <div className=\"flex gap-4 pb-4\">\n                            <div className=\"text-right\">\n                                <p className=\"text-xs font-bold text-slate-400 uppercase\">Edad</p>\n                                <p className=\"text-sm font-bold text-slate-700\">{patient.age} aÃ±os</p>\n                            </div>\n                            <div className=\"text-right\">\n                                <p className=\"text-xs font-bold text-slate-400 uppercase\">Ingreso</p>\n                                <p className=\"text-sm font-bold text-slate-700\">{patient.joinedDate}</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </Card>\n            <div className=\"border-b border-slate-200 sticky top-0 bg-[#F8FAFC]/95 backdrop-blur-sm z-10 pt-2 md:pt-4\">\n                <div className=\"flex gap-4 md:gap-8 overflow-x-auto no-scrollbar px-4 md:px-0\">\n                    {tabs.map((tab) => (\n                        <button\n                            key={tab.id}\n                            onClick={() => setActiveTab(tab.id)}\n                            className={`pb-4 flex items-center gap-2 text-sm font-bold transition-all relative ${activeTab === tab.id ? 'text-pink-600' : 'text-slate-500 hover:text-slate-800'}`}\n                        >\n                            <tab.icon size={18} /> {tab.label}\n                            {activeTab === tab.id && (\n                                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-pink-600 rounded-t-full\" />\n                            )}\n                        </button>\n                    ))}\n                </div>\n            </div>\n\n            <div className=\"min-h-[400px]\">\n\n                {/* UNIFIED TREATMENT TAB */}\n                {activeTab === 'treatment' && (\n                    <div className=\"animate-in fade-in space-y-8\">\n\n                        {/* 1. CLINICAL FORMULATION */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <FormulationSection\n                                title=\"SÃ­ntesis DiagnÃ³stica\"\n                                optionsKey=\"synthesis\"\n                                fieldKey=\"synthesis\"\n                                initialData={patient.clinicalFormulation?.synthesis as FormulationData}\n                                onSave={(key, data) => {\n                                    onUpdate({\n                                        ...patient,\n                                        clinicalFormulation: {\n                                            ...patient.clinicalFormulation,\n                                            [key]: data\n                                        }\n                                    });\n                                    logActivity('report', 'SÃ­ntesis DiagnÃ³stica actualizada');\n                                    showToast('SÃ­ntesis guardada correctamente', 'success');\n                                }}\n                            />\n                            <FormulationSection\n                                title=\"Objetivos TerapÃ©uticos\"\n                                optionsKey=\"objectives\"\n                                fieldKey=\"objectives\"\n                                initialData={patient.clinicalFormulation?.objectives as FormulationData}\n                                onSave={(key, data) => {\n                                    onUpdate({\n                                        ...patient,\n                                        clinicalFormulation: {\n                                            ...patient.clinicalFormulation,\n                                            [key]: data\n                                        }\n                                    });\n                                    logActivity('report', 'Objetivos actualizados');\n                                    showToast('Objetivos guardados correctamente', 'success');\n                                }}\n                            />\n                        </div>\n\n                        {/* 2. SAFETY & ISO PROTOCOLS */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n\n                            {/* SAFETY */}\n                            <div className=\"bg-white rounded-xl p-6 border border-slate-200 shadow-sm relative overflow-hidden group\">\n                                <div className=\"absolute top-0 right-0 w-24 h-24 bg-red-50 rounded-bl-full -mr-4 -mt-4 z-0 transition-transform group-hover:scale-110\"></div>\n                                <div className=\"relative z-10\">\n                                    <div className=\"flex justify-between items-start mb-4\">\n                                        <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                                            <ShieldCheck className=\"text-red-600\" size={20} /> Seguridad ClÃ­nica\n                                        </h3>\n                                        <Button size=\"sm\" variant=\"secondary\" onClick={() => setShowSafetyModal(true)}>\n                                            Editar Seguridad\n                                        </Button>\n                                    </div>\n\n                                    {patient.safetyProfile ? (\n                                        <div className=\"space-y-4\">\n                                            {highRisks.length > 0 ? (\n                                                <div className=\"flex flex-wrap gap-2\">\n                                                    {highRisks.map((r) => (\n                                                        <Badge key={r} variant=\"error\">\n                                                            {RISK_LABELS[r] || r}\n                                                        </Badge>\n                                                    ))}\n                                                </div>\n                                            ) : (\n                                                <span className=\"text-emerald-600 text-sm font-bold flex items-center gap-2\">\n                                                    <CheckSquare size={16} /> Sin riesgos fÃ­sicos crÃ­ticos\n                                                </span>\n                                            )}\n                                            <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100\">\n                                                <div>\n                                                    <p className=\"text-[10px] font-bold text-slate-400 uppercase\">Movilidad</p>\n                                                    <p className=\"font-bold text-slate-700 capitalize text-sm\">\n                                                        {MOBILITY_MAP[patient.safetyProfile.mobilityAid || 'none'] || patient.safetyProfile.mobilityAid}\n                                                    </p>\n                                                </div>\n                                                <div>\n                                                    <p className=\"text-[10px] font-bold text-slate-400 uppercase\">Alergias</p>\n                                                    <p className=\"text-sm text-slate-600 truncate\">{patient.safetyProfile.allergies || 'Ninguna'}</p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    ) : (\n                                        <div className=\"text-center py-6 bg-slate-50 rounded-lg border border-dashed border-slate-200\">\n                                            <Button size=\"sm\" onClick={() => setShowSafetyModal(true)}>Configurar Seguridad</Button>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* ISO */}\n                            <div className=\"bg-white rounded-xl p-6 border border-slate-200 shadow-sm relative overflow-hidden group\">\n                                <div className=\"absolute top-0 right-0 w-24 h-24 bg-indigo-50 rounded-bl-full -mr-4 -mt-4 z-0 transition-transform group-hover:scale-110\"></div>\n                                <div className=\"relative z-10\">\n                                    <div className=\"flex justify-between items-start mb-4\">\n                                        <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                                            <Music className=\"text-indigo-600\" size={20} /> Identidad Sonora (ISO)\n                                        </h3>\n                                        <Button size=\"sm\" variant=\"secondary\" onClick={() => setShowIsoModal(true)}>\n                                            Editar ISO\n                                        </Button>\n                                    </div>\n                                    {patient.musicalIdentity ? (\n                                        <div className=\"space-y-3\">\n                                            <div>\n                                                <p className=\"text-[10px] font-bold text-slate-400 uppercase mb-1\">ISO Nocivo</p>\n                                                <div className=\"flex flex-wrap gap-1\">\n                                                    {patient.musicalIdentity.dislikes.length > 0 ?\n                                                        patient.musicalIdentity.dislikes.map((s, i) => <span key={i} className=\"text-xs bg-red-50 text-red-700 px-2 py-0.5 rounded border border-red-100\">{s}</span>)\n                                                        : <span className=\"text-xs text-slate-400\">-</span>\n                                                    }\n                                                </div>\n                                            </div>\n                                            <div>\n                                                <p className=\"text-[10px] font-bold text-slate-400 uppercase mb-1\">Favoritos</p>\n                                                <p className=\"text-sm text-slate-600 truncate\">\n                                                    {patient.musicalIdentity.likes.join(', ') || 'Sin favoritos registrados'}\n                                                </p>\n                                            </div>\n                                            <div>\n                                                <p className=\"text-[10px] font-bold text-slate-400 uppercase mb-1\">Instrumentos</p>\n                                                <p className=\"text-sm text-slate-600 truncate\">\n                                                    {patient.musicalIdentity.instrumentsOfInterest?.join(', ') || 'Ninguno registrado'}\n                                                </p>\n                                            </div>\n                                        </div>\n                                    ) : (\n                                        <div className=\"text-center py-6 bg-slate-50 rounded-lg border border-dashed border-slate-200\">\n                                            <Button size=\"sm\" onClick={() => setShowIsoModal(true)}>Crear Perfil Musical</Button>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* 3. PHASE CARD */}\n                        <div className=\"bg-white rounded-2xl p-8 border border-slate-200 shadow-sm flex items-center gap-8 relative overflow-hidden\">\n                            <div\n                                className={`absolute top-0 right-0 w-64 h-64 bg-gradient-to-br ${TREATMENT_PHASES[1].color} opacity-10 rounded-full blur-3xl -mr-16 -mt-16`}\n                            ></div>\n                            <div className=\"relative z-10 flex-1\">\n                                <div className=\"flex items-center gap-3 mb-2\">\n                                    <Badge variant=\"brand\">Fase {currentPhase.id} de 5</Badge>\n                                    <span className=\"text-slate-400 text-xs font-bold uppercase tracking-wider\">\n                                        Plan de 20 Sesiones\n                                    </span>\n                                </div>\n                                <h2 className=\"text-2xl font-bold text-slate-900 mb-1\">{currentPhase.name}</h2>\n                                <p className=\"text-slate-500\">Objetivo: {currentPhase.focus}</p>\n                            </div>\n                            <div className=\"relative z-10 text-right\">\n                                <div className=\"text-4xl font-black text-slate-900\">{validSessions.length}</div>\n                                <div className=\"text-xs font-bold text-slate-400 uppercase\">Sesiones</div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {activeTab === 'evaluation' && (\n                    <Card className=\"animate-in fade-in p-8\">\n                        <div className=\"flex justify-between items-center mb-8\">\n                            <h3 className=\"font-bold text-slate-800 text-lg\">EvoluciÃ³n ClÃ­nica</h3>\n                            <div className=\"flex gap-4 text-xs font-medium text-slate-500\">\n                                <span className=\"flex items-center gap-1\">\n                                    <div className=\"w-2 h-2 bg-slate-300 rounded-full\" /> LÃ­nea Base\n                                </span>\n                                <span className=\"flex items-center gap-1\">\n                                    <div className=\"w-2 h-2 bg-pink-500 rounded-full\" /> Actual\n                                </span>\n                            </div>\n                        </div>\n\n                        <div className=\"mb-8 p-6 bg-white rounded-2xl border border-slate-100 shadow-sm\">\n                            <h4 className=\"font-bold text-slate-700 text-sm mb-4 flex items-center gap-2\">\n                                <BarChart3 size={16} className=\"text-pink-600\" /> Curva de Progreso (Ãndice Global)\n                            </h4>\n                            <EvidenceChart sessions={patient.sessions || []} />\n                        </div>\n\n                        <div className=\"mb-8 p-4 bg-slate-50 rounded-xl border border-slate-200 grid grid-cols-2 md:flex md:gap-8 gap-4\">\n                            <div>\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest block\">\n                                    MOCA (Cognitivo)\n                                </span>\n                                <span className=\"text-lg font-bold text-slate-800\">\n                                    {patient.cognitiveScores?.moca || '-'}\n                                </span>\n                            </div>\n                            <div>\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest block\">\n                                    MMSE (Mini-Mental)\n                                </span>\n                                <span className=\"text-lg font-bold text-slate-800\">\n                                    {patient.cognitiveScores?.mmse || '-'}\n                                </span>\n                            </div>\n                            <div>\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest block\">\n                                    GDS (Reisberg)\n                                </span>\n                                <span className=\"text-lg font-bold text-slate-800\">\n                                    {patient.cognitiveScores?.gds || '-'}\n                                </span>\n                            </div>\n                            <div>\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest block\">\n                                    Fecha EvaluaciÃ³n\n                                </span>\n                                <span className=\"text-sm font-medium text-slate-600\">\n                                    {patient.cognitiveScores?.date || '-'}\n                                </span>\n                            </div>\n                            <Button\n                                size=\"sm\"\n                                variant=\"secondary\"\n                                className=\"col-span-2 md:col-span-1 md:ml-auto h-fit my-auto w-full md:w-auto mt-2 md:mt-0\"\n                                onClick={() => setShowCognitiveModal(true)}\n                                icon={PenTool}\n                            >\n                                Actualizar EvaluaciÃ³n\n                            </Button>\n                        </div>\n                    </Card>\n                )}\n\n                {activeTab === 'documents' && (\n                    <Card className=\"animate-in fade-in p-6\">\n                        <h3 className=\"font-bold text-slate-800 text-lg mb-6 flex items-center gap-2\">\n                            <Folder className=\"text-pink-600\" /> Expediente Digital\n                        </h3>\n                        <DocumentsTab />\n                    </Card>\n                )}\n\n                {activeTab === 'sessions' && (\n                    <div className=\"space-y-6 animate-in fade-in\">\n                        <PhaseProgress\n                            sessionCount={validSessions.length}\n                            adherence={\n                                activeSessions.length > 0\n                                    ? Math.round((validSessions.length / activeSessions.length) * 100)\n                                    : 100\n                            }\n                        />\n                        <div className=\"flex justify-between items-center\">\n                            <h3 className=\"font-bold text-slate-800\">Historial de Sesiones</h3>\n                            <Button\n                                icon={PlusCircle}\n                                onClick={() => {\n                                    if (!isPremium && (patient.sessions || []).length >= 1) {\n                                        setShowPaywall(true);\n                                        return;\n                                    }\n                                    setSelectedSession(undefined);\n                                    setShowSessionModal(true);\n                                }}\n                            >\n                                Nueva SesiÃ³n\n                            </Button>\n                        </div>\n                        {activeSessions.map((s) => (\n                            <div\n                                key={s.id}\n                                className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow flex gap-4\"\n                            >\n                                <div className=\"flex flex-col items-center justify-center p-3 bg-slate-50 rounded-lg h-fit min-w-[80px]\">\n                                    <span className=\"text-xs font-bold text-slate-400 uppercase\">\n                                        {new Date(s.date.split('/').reverse().join('-')).toLocaleDateString('es-ES', {\n                                            month: 'short',\n                                        })}\n                                    </span>\n                                    <span className=\"text-xl font-black text-slate-800\">\n                                        {new Date(s.date.split('/').reverse().join('-')).getDate()}\n                                    </span>\n                                </div>\n                                <div className=\"flex-1\">\n                                    <div className=\"flex justify-between items-center mb-2\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <h4 className=\"font-bold text-slate-800\">SesiÃ³n ClÃ­nica</h4>\n                                            {s.isAbsent ? (\n                                                <Badge variant=\"error\">Ausencia</Badge>\n                                            ) : (\n                                                <Badge variant=\"neutral\">Fase {sessionPhaseMap[s.id] || 1}</Badge>\n                                            )}\n                                        </div>\n                                        <div className=\"flex gap-1\">\n                                            <Button\n                                                size=\"sm\"\n                                                variant=\"ghost\"\n                                                icon={Edit}\n                                                onClick={() => {\n                                                    setSelectedSession(s);\n                                                    setShowSessionModal(true);\n                                                }}\n                                            >\n                                                {null}\n                                            </Button>\n                                            <Button\n                                                size=\"sm\"\n                                                variant=\"ghost\"\n                                                className=\"text-red-400 hover:bg-red-50 hover:text-red-600\"\n                                                icon={Trash2}\n                                                onClick={() => handleDeleteSession(s.id)}\n                                            >\n                                                {null}\n                                            </Button>\n                                        </div>\n                                    </div>\n                                    <p className=\"text-slate-600 text-sm leading-relaxed mb-3\">{s.notes}</p>\n                                    <div className=\"mt-3 flex gap-2\">\n                                        {s.activityDetails && Object.keys(s.activityDetails).length > 0\n                                            ? Object.keys(s.activityDetails).map((k) => (\n                                                <Badge key={k} variant=\"brand\">\n                                                    {k}\n                                                </Badge>\n                                            ))\n                                            : null}\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n\n                {activeTab === 'billing' && (\n                    <div className=\"animate-in fade-in\">\n                        <div className=\"bg-white rounded-xl border border-slate-200 overflow-hidden\">\n                            <div className=\"bg-slate-50 px-6 py-4 border-b border-slate-200 flex justify-between items-center\">\n                                <h3 className=\"font-bold text-slate-700\">Control de Pagos</h3>\n                                <div className=\"flex gap-3\">\n                                    <div className=\"text-right\">\n                                        <p className=\"text-[10px] uppercase font-bold text-slate-400\">Deuda Total</p>\n                                        <p className=\"text-xl font-black text-red-600\">\n                                            {activeSessions.reduce((acc, s) => acc + (s.paid ? 0 : s.price || 0), 0)} â‚¬\n                                        </p>\n                                    </div>\n                                    <Button\n                                        variant=\"primary\"\n                                        size=\"md\"\n                                        onClick={handlePrintGlobalInvoice}\n                                        icon={FileText}\n                                    >\n                                        Generar Factura Global\n                                    </Button>\n                                </div>\n                            </div>\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"w-full text-sm text-left\">\n                                    <thead className=\"text-xs text-slate-500 uppercase bg-slate-50/50\">\n                                        <tr>\n                                            <th className=\"px-6 py-3\">Fecha</th>\n                                            <th className=\"px-6 py-3\">Concepto</th>\n                                            <th className=\"px-6 py-3\">Importe</th>\n                                            <th className=\"px-6 py-3 text-right\">Estado</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-slate-100\">\n                                        {activeSessions.map((s) => (\n                                            <tr key={s.id} className=\"hover:bg-slate-50\">\n                                                <td className=\"px-6 py-4 font-mono text-slate-500 whitespace-nowrap\">\n                                                    {s.date}\n                                                </td>\n                                                <td className=\"px-6 py-4 font-medium text-slate-900 min-w-[200px]\">\n                                                    SesiÃ³n {s.type === 'group' ? 'Grupal' : 'Individual'}\n                                                    {s.isAbsent && (\n                                                        <span className=\"text-red-500 ml-2 text-xs font-bold\">(Ausencia)</span>\n                                                    )}\n                                                </td>\n                                                <td className=\"px-6 py-4 font-bold text-slate-700\">{s.price}â‚¬</td>\n                                                <td className=\"px-6 py-4 text-right\">\n                                                    <button\n                                                        onClick={() => {\n                                                            const isPaying = !s.paid;\n                                                            const updated = patient.sessions?.map((sess) =>\n                                                                sess.id === s.id ? { ...sess, paid: isPaying } : sess,\n                                                            );\n                                                            if (updated) {\n                                                                onUpdate({ ...patient, sessions: updated });\n                                                                if (isPaying) logActivity('finance', `Pago registrado: SesiÃ³n de ${patient.name}`);\n                                                            }\n                                                        }}\n                                                        className={`px-3 py-1 rounded-full text-xs font-bold ${s.paid ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700 hover:bg-red-200'}`}\n                                                    >\n                                                        {s.paid ? 'PAGADO' : 'PENDIENTE'}\n                                                    </button>\n                                                </td>\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {activeTab === 'discharge' && (\n                    <div className=\"animate-in fade-in space-y-6\">\n                        <div className=\"bg-emerald-50 rounded-xl p-8 border border-emerald-100 flex items-start gap-6\">\n                            <div className=\"p-4 bg-white rounded-full text-emerald-600 shadow-sm\">\n                                <CheckSquare size={32} />\n                            </div>\n                            <div className=\"space-y-4 flex-1\">\n                                <h3 className=\"font-bold text-emerald-900 text-lg\">\n                                    Criterios de Alta TerapÃ©utica\n                                </h3>\n                                <p className=\"text-emerald-800/80 leading-relaxed\">\n                                    El proceso de alta se inicia cuando se han alcanzado &gt;80% de los objetivos\n                                    terapÃ©uticos o por decisiÃ³n clÃ­nica justificada. AsegÃºrese de completar el informe\n                                    final antes de archivar el expediente.\n                                </p>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\n                                    <div className=\"bg-white p-4 rounded-lg border border-emerald-100 flex items-center gap-3\">\n                                        <div\n                                            className={`w-3 h-3 rounded-full ${validSessions.length >= 20 ? 'bg-emerald-500' : 'bg-slate-300'}`}\n                                        />\n                                        <span className=\"text-sm font-medium text-slate-700\">\n                                            Ciclo Completo (20 Sesiones)\n                                        </span>\n                                    </div>\n                                    <div className=\"bg-white p-4 rounded-lg border border-emerald-100 flex items-center gap-3\">\n                                        <div\n                                            className={`w-3 h-3 rounded-full ${patient.cognitiveScores?.gds ? 'bg-emerald-500' : 'bg-slate-300'}`}\n                                        />\n                                        <span className=\"text-sm font-medium text-slate-700\">\n                                            ReevaluaciÃ³n Final Realizada\n                                        </span>\n                                    </div>\n                                </div>\n                                <div className=\"flex gap-2\">\n                                    <Button\n                                        onClick={() => setShowAdmissionChecklist(true)}\n                                        variant=\"secondary\"\n                                        icon={ClipboardCheck}\n                                    >\n                                        AdmisiÃ³n\n                                    </Button>\n                                    <Button\n                                        onClick={() => setShowReportModal(true)}\n                                        variant=\"secondary\"\n                                        icon={FileText}\n                                    >\n                                        Informe\n                                    </Button>\n                                    <Button\n                                        variant=\"danger\"\n                                        icon={Trash2}\n                                        onClick={() => {\n                                            if (\n                                                confirm(\n                                                    \"Â¿Archivar paciente como 'Alta ClÃ­nica'? Esta acciÃ³n moverÃ¡ el expediente al histÃ³rico.\",\n                                                )\n                                            ) {\n                                                logActivity('system', `Alta ClÃ­nica: Paciente ${patient.name} archivado`);\n                                                showToast('Paciente archivado correctamente', 'success');\n                                                onBack();\n                                            }\n                                        }}\n                                    >\n                                        Archivar Expediente\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n            </div>\n        </div>\n    );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\PatientsDirectory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\components\\CustomerRadar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\components\\EvaluationTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\components\\FormulationTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[382,385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[382,385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[921,924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[921,924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card } from '../../../components/ui/Card';\nimport { ClinicalFormulation, FormulationData } from '../../../lib/types';\nimport { FORMULATION_OPTIONS as FORMULATION_DATA } from '../../../lib/constants'; // Importing constant data\n\ninterface FormulationTabProps {\n  data: ClinicalFormulation;\n  isEditing: boolean;\n  onChange: (field: string, value: any) => void;\n}\n\nexport const FormulationTab: React.FC<FormulationTabProps> = ({ data, isEditing, onChange }) => {\n  // Helper para manejar cambios en legacy vs new structure\n  // Si data.synthesis es string (legacy), asumimos text. Si es objeto, usamos text y selected\n  const getText = (field: string) => {\n    const val = data ? data[field as keyof FormulationData] : undefined;\n    if (typeof val === 'string') return val;\n    return val?.text || '';\n  };\n\n  const getSelected = (field: string): string[] => {\n    const val = (data as any)[field];\n    if (typeof val === 'object' && val.selected) return val.selected;\n    return [];\n  };\n\n  const renderSection = (title: string, field: keyof typeof FORMULATION_DATA, color: string) => {\n    const options = (FORMULATION_DATA as Record<string, string[]>)[field] || [];\n    // const currentText = getText(title.toLowerCase()); // Simplificacion: usar el key correcto\n    // Mejor usar un mapeo explÃ­cito\n    const fieldKeyMap: Record<string, string> = {\n      'HipÃ³tesis de Trabajo': 'hypothesis',\n      'SÃ­ntesis DiagnÃ³stica': 'synthesis',\n      'Habilidades Preservadas': 'preserved',\n      'Dificultades Principales': 'difficulties',\n      Reguladores: 'regulators',\n    };\n    const key = fieldKeyMap[title] || field;\n\n    const currentSelections = getSelected(key);\n    const textVal = getText(key);\n\n    return (\n      <Card className=\"p-6 border-l-4\" style={{ borderColor: color }} noPadding>\n        <div className=\"p-6\">\n          <h4 className=\"font-bold text-slate-800 mb-4 uppercase tracking-wider text-xs flex items-center gap-2\">\n            <div className={`w-2 h-2 rounded-full bg-[${color}]`}></div> {title}\n          </h4>\n\n          {isEditing ? (\n            <div className=\"space-y-4\">\n              <div className=\"flex flex-wrap gap-2 mb-3\">\n                {options.map((opt: string) => (\n                  <button\n                    key={opt}\n                    onClick={() => {\n                      const newSel = currentSelections.includes(opt)\n                        ? currentSelections.filter((s) => s !== opt)\n                        : [...currentSelections, opt];\n                      onChange(key, { text: textVal, selected: newSel });\n                    }}\n                    className={`px-3 py-1 rounded-full text-[10px] font-bold border transition-all ${currentSelections.includes(opt)\n                      ? 'bg-slate-800 text-white border-slate-800'\n                      : 'bg-white text-slate-500 border-slate-200 hover:border-slate-400'\n                      }`}\n                  >\n                    {opt}\n                  </button>\n                ))}\n              </div>\n              <textarea\n                className=\"input-pro min-h-[100px]\"\n                value={textVal}\n                onChange={(e) =>\n                  onChange(key, { text: e.target.value, selected: currentSelections })\n                }\n                placeholder={`Describa detalladamente...`}\n              />\n            </div>\n          ) : (\n            <div>\n              {currentSelections.length > 0 && (\n                <div className=\"flex flex-wrap gap-2 mb-4\">\n                  {currentSelections.map((s) => (\n                    <span\n                      key={s}\n                      className=\"px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-[10px] font-bold uppercase\"\n                    >\n                      {s}\n                    </span>\n                  ))}\n                </div>\n              )}\n              <p className=\"text-sm text-slate-600 leading-relaxed max-w-2xl\">\n                {textVal || (\n                  <span className=\"text-slate-300 italic\">Sin informaciÃ³n registrada.</span>\n                )}\n              </p>\n            </div>\n          )}\n        </div>\n      </Card>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n      {renderSection('SÃ­ntesis DiagnÃ³stica', 'synthesis', '#EC008C')}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {renderSection('Habilidades Preservadas', 'preserved', '#10B981')}\n        {renderSection('Dificultades Principales', 'difficulties', '#F59E0B')}\n      </div>\n      {renderSection('HipÃ³tesis de Trabajo', 'hypothesis', '#6366F1')}\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\components\\GDSSelectionCards.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":4,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":4,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\n\n\nexport const GDS_STAGES = [\n  {\n    id: 1,\n    title: 'GDS 1: Sin Deterioro',\n    desc: 'Ausencia de quejas cognitivas. Examen normal.',\n    color: 'border-emerald-200 bg-emerald-50',\n  },\n  {\n    id: 2,\n    title: 'GDS 2: Queja Subjetiva',\n    desc: 'Olvidos benignos (nombres, lugares). No objetivable.',\n    color: 'border-emerald-200 bg-emerald-50',\n  },\n  {\n    id: 3,\n    title: 'GDS 3: Deterioro Leve',\n    desc: 'Defecto claro. Se pierde en viajes, olvida nombres nuevos.',\n    color: 'border-amber-200 bg-amber-50',\n  },\n  {\n    id: 4,\n    title: 'GDS 4: Deterioro Moderado',\n    desc: 'No maneja finanzas complejas. NegaciÃ³n del dÃ©ficit.',\n    color: 'border-amber-200 bg-amber-50',\n  },\n  {\n    id: 5,\n    title: 'GDS 5: Mod-Grave',\n    desc: 'Necesita ayuda para elegir ropa. DesorientaciÃ³n T/E.',\n    color: 'border-orange-200 bg-orange-50',\n  },\n  {\n    id: 6,\n    title: 'GDS 6: Grave',\n    desc: 'Dependencia vestir/baÃ±o. Incontinencia. Cambios carÃ¡cter.',\n    color: 'border-red-200 bg-red-50',\n  },\n  {\n    id: 7,\n    title: 'GDS 7: Muy Grave',\n    desc: 'PÃ©rdida lenguaje y motor. Dependencia total.',\n    color: 'border-red-200 bg-red-50',\n  },\n];\n\ninterface GDSSelectionCardsProps {\n  selected: number;\n  onSelect: (val: number) => void;\n}\n\nexport const GDSSelectionCards: React.FC<GDSSelectionCardsProps> = ({ selected, onSelect }) => {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n      {GDS_STAGES.map((stage) => (\n        <div\n          key={stage.id}\n          onClick={() => onSelect(stage.id)}\n          className={`\n                        cursor-pointer relative overflow-hidden rounded-xl border-2 p-4 transition-all duration-300\n                        ${selected === stage.id\n              ? 'border-pink-500 shadow-3d scale-[1.02] bg-white ring-2 ring-pink-200'\n              : 'border-slate-100 bg-white hover:border-slate-300 hover:shadow-md'\n            }\n                    `}\n        >\n          <div\n            className={`absolute top-0 right-0 px-2 py-1 text-[10px] font-bold rounded-bl-lg ${selected === stage.id ? 'bg-pink-500 text-white' : 'bg-slate-100 text-slate-500'}`}\n          >\n            NIVEL {stage.id}\n          </div>\n\n          <h4\n            className={`font-bold text-sm mb-2 ${selected === stage.id ? 'text-pink-700' : 'text-slate-800'}`}\n          >\n            {stage.title}\n          </h4>\n\n          <p className=\"text-xs text-slate-500 leading-relaxed font-medium\">{stage.desc}</p>\n\n          {selected === stage.id && (\n            <div className=\"absolute inset-x-0 bottom-0 h-1 bg-gradient-to-r from-pink-500 to-rose-500\"></div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\components\\PatientTabs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\n\ninterface PatientTabsProps {\n  activeTab: 'plan' | 'formulation' | 'evaluation' | 'sessions' | 'billing';\n  onChange: (tab: 'plan' | 'formulation' | 'evaluation' | 'sessions' | 'billing') => void;\n}\n\nexport const PatientTabs: React.FC<PatientTabsProps> = ({ activeTab, onChange }) => {\n  const tabs = [\n    { id: 'plan', label: 'Plan TerapÃ©utico' },\n    { id: 'formulation', label: 'FormulaciÃ³n ClÃ­nica' },\n    { id: 'evaluation', label: 'EvaluaciÃ³n y Progreso' },\n    { id: 'sessions', label: 'Historial Sesiones' },\n    { id: 'billing', label: 'FacturaciÃ³n' },\n  ];\n\n  return (\n    <div className=\"flex gap-2 mb-6 overflow-x-auto pb-2 custom-scrollbar\">\n      {tabs.map((tab) => (\n        <button\n          key={tab.id}\n          onClick={() => onChange(tab.id as any)}\n          className={`px-5 py-2.5 rounded-xl text-sm font-bold whitespace-nowrap transition-all border ${\n            activeTab === tab.id\n              ? 'bg-slate-900 text-white border-slate-900 shadow-lg'\n              : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50 hover:text-slate-800'\n          }`}\n        >\n          {tab.label}\n        </button>\n      ))}\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\components\\PhaseProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\AdmissionChecklistModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\ClinicalGuideModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1823,1826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1823,1826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { X, BookOpen, User, Brain, Heart, Sparkles } from 'lucide-react';\nimport { CLINICAL_GUIDES } from '../../../lib/clinicalUtils';\n\ninterface ClinicalGuideModalProps {\n  onClose: () => void;\n}\n\nexport const ClinicalGuideModal: React.FC<ClinicalGuideModalProps> = ({ onClose }) => {\n  const [activeTab, setActiveTab] = useState<'dementia' | 'neuro' | 'mood' | 'other'>('dementia');\n  const guide = CLINICAL_GUIDES[activeTab];\n\n  const tabs = [\n    { id: 'dementia', label: 'Cognitivo', icon: Brain, color: 'text-pink-600', bg: 'bg-pink-50' },\n    { id: 'neuro', label: 'NeurolÃ³gico', icon: User, color: 'text-blue-600', bg: 'bg-blue-50' },\n    {\n      id: 'mood',\n      label: 'Salud Mental',\n      icon: Heart,\n      color: 'text-emerald-600',\n      bg: 'bg-emerald-50',\n    },\n    { id: 'other', label: 'Bienestar', icon: Sparkles, color: 'text-amber-600', bg: 'bg-amber-50' },\n  ];\n\n  return (\n    <div className=\"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white w-full max-w-4xl rounded-2xl shadow-3d overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95\">\n        <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-10\">\n          <h2 className=\"text-xl font-bold flex items-center gap-3 text-slate-800\">\n            <BookOpen className=\"text-pink-600\" /> GuÃ­as ClÃ­nicas BÃ¡sicas\n          </h2>\n          <button onClick={onClose}>\n            <X className=\"text-slate-400 hover:text-slate-600\" />\n          </button>\n        </div>\n\n        <div className=\"flex border-b border-slate-100 overflow-x-auto\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as any)}\n              className={`flex-1 min-w-[120px] py-4 flex flex-col items-center gap-2 border-b-2 transition-all ${activeTab === tab.id ? `${tab.color} border-current bg-slate-50` : 'text-slate-400 border-transparent hover:text-slate-600 hover:bg-slate-50'}`}\n            >\n              <tab.icon size={20} />\n              <span className=\"text-xs font-bold uppercase tracking-wide\">{tab.label}</span>\n            </button>\n          ))}\n        </div>\n\n        <div className=\"p-8 overflow-y-auto bg-slate-50/50\">\n          <div className=\"prose prose-slate max-w-none\">\n            <div className=\"bg-white p-8 rounded-2xl border border-slate-200 shadow-sm mb-6\">\n              <h3 className=\"text-2xl font-black text-slate-800 mb-6 flex items-center gap-3\">\n                {guide.title}\n                <span className=\"text-xs font-bold bg-slate-100 text-slate-500 px-3 py-1 rounded-full uppercase tracking-widest\">\n                  Protocolo MT\n                </span>\n              </h3>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                <div>\n                  <h4 className=\"font-bold text-pink-600 mb-4 border-b border-pink-100 pb-2 uppercase text-sm tracking-wide\">\n                    Objetivos TerapÃ©uticos\n                  </h4>\n                  <ul className=\"space-y-3\">\n                    {guide.objectives.map((o, i) => (\n                      <li key={i} className=\"flex items-start gap-3 text-slate-700\">\n                        <div className=\"w-1.5 h-1.5 bg-pink-500 rounded-full mt-2 shrink-0\"></div>\n                        {o}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n                <div>\n                  <h4 className=\"font-bold text-blue-600 mb-4 border-b border-blue-100 pb-2 uppercase text-sm tracking-wide\">\n                    TÃ©cnicas Sugeridas\n                  </h4>\n                  <ul className=\"space-y-3\">\n                    {guide.techniques.map((t, i) => (\n                      <li key={i} className=\"flex items-start gap-3 text-slate-700\">\n                        <div className=\"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 shrink-0\"></div>\n                        {t}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              </div>\n\n              <div className=\"mt-8 bg-amber-50 p-6 rounded-xl border border-amber-100\">\n                <h4 className=\"font-bold text-amber-700 mb-3 flex items-center gap-2 uppercase text-sm tracking-wide\">\n                  <div className=\"w-2 h-2 bg-amber-500 rounded-full animate-pulse\"></div>{' '}\n                  Precauciones y Contraindicaciones\n                </h4>\n                <ul className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                  {guide.precautions.map((p, i) => (\n                    <li\n                      key={i}\n                      className=\"text-sm font-medium text-amber-900/80 flex items-center gap-2\"\n                    >\n                      <span className=\"text-amber-400\">â€¢</span> {p}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\CognitiveModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1707,1710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1707,1710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8357,8360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8357,8360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Brain, X, Activity, Music, Baby } from 'lucide-react';\nimport { Button } from '../../../components/ui/Button';\nimport {\n    EVALUATION_AREAS_ADULT,\n    MOCA_SECTIONS,\n    MMSE_SECTIONS,\n    CHILD_DEV_DOMAINS,\n    ADULT_DEV_DOMAINS,\n    CHILD_MUSICAL_PROFILE,\n    GDS_STAGES,\n    CHILD_LEVELS,\n} from '../../../lib/constants';\n// import { EVALUATION_AREAS } from '../../../lib/clinicalUtils';\nimport { CognitiveScores } from '../../../lib/types';\n// import { CognitiveRadar } from '../components/CustomerRadar';\nimport { formatDateForDisplay } from '../../../lib/patientUtils';\nimport { formatDateForInput } from '../../../lib/utils';\n\n// Helper for GDS in new modal style\nconst GDSSelector = ({ value, onChange }: { value: string; onChange: (v: string) => void }) => (\n    <div className=\"bg-slate-50 rounded-xl p-4 border border-slate-200\">\n        <div className=\"flex justify-between items-center mb-2\">\n            <span className=\"font-bold text-slate-700\">Escala GDS</span>\n            <span className=\"text-xl font-black text-indigo-600\">{value || '-'}</span>\n        </div>\n        <select\n            className=\"w-full text-xs p-2 rounded border bg-white\"\n            value={value}\n            onChange={(e) => onChange(e.target.value)}\n        >\n            <option value=\"\">- Seleccionar Fase -</option>\n            {GDS_STAGES.map((s) => (\n                <option key={s.value} value={s.value}>\n                    {s.label}\n                </option>\n            ))}\n        </select>\n    </div>\n);\n\n// Extended interface for frontend-specific fields\ninterface ExtendedCognitiveScores extends CognitiveScores {\n    childProfile?: Record<string, any>;\n    childObs?: string;\n    functionalScores?: number[];\n    // Removed index signature to enforce strictness. Access via specific keys or casting if absolutely necessary but avoided.\n}\n\ninterface CognitiveModalProps {\n    onClose: () => void;\n    onSave: (data: CognitiveScores) => void;\n    initialData?: ExtendedCognitiveScores;\n    initialScores?: number[];\n    isChild?: boolean;\n    isGeriatric?: boolean; // NEW\n    initialTab?: 'general' | 'moca' | 'mmse';\n}\n\nexport const CognitiveModal: React.FC<CognitiveModalProps> = ({\n    onClose,\n    onSave,\n    initialData,\n    initialScores,\n    isChild = false,\n    isGeriatric = false,\n    initialTab = 'general',\n}) => {\n    // STARTING TAB LOGIC\n    const [activeTab, setActiveTab] = useState<'general' | 'moca' | 'mmse'>(initialTab);\n    const [date, setDate] = useState(\n        initialData?.date\n            ? formatDateForInput(initialData.date)\n            : new Date().toISOString().split('T')[0],\n    );\n\n    // Adult States\n    const [mocaDetails, setMocaDetails] = useState(initialData?.mocaDetails || {});\n    const [mmseDetails, setMmseDetails] = useState(initialData?.mmseDetails || {});\n    const [gdsValue, setGdsValue] = useState(String(initialData?.gds || ''));\n    const [functionalScores, setFunctionalScores] = useState<number[]>(\n        initialScores || Array(EVALUATION_AREAS_ADULT.length).fill(0),\n    );\n\n    // Child States\n    const [childProfile, setChildProfile] = useState<Record<string, Record<string, number>>>(\n        initialData?.childProfile || {},\n    );\n    const [childObs, setChildObs] = useState(initialData?.childObs || '');\n\n    const mocaTotal = MOCA_SECTIONS.reduce((sum, s) => sum + parseInt(String(mocaDetails[s.id] || 0)), 0);\n    const mmseTotal = MMSE_SECTIONS.reduce((sum, s) => sum + parseInt(String(mmseDetails[s.id] || 0)), 0);\n\n    // Updates\n    const updateChildProfile = (domainId: string, item: string, value: number) => {\n        setChildProfile((prev) => ({\n            ...prev,\n            [domainId]: { ...(prev[domainId] || {}), [item]: value },\n        }));\n    };\n\n    const handleSave = () => {\n        // Child Radar Calculation logic\n        let childRadarScores: number[] = [];\n        if (isChild) {\n            const calculateDomainAvg = (domainId: string, itemList: string[]) => {\n                const domainData = childProfile[domainId] || {};\n                const values = itemList.map((item) => domainData[item] || 0);\n                const sum = values.reduce((a, b) => a + b, 0);\n                return values.length > 0 ? Math.round(sum / values.length) : 0;\n            };\n            childRadarScores = [\n                calculateDomainAvg('sensory', CHILD_DEV_DOMAINS[0].items),\n                calculateDomainAvg('comm', CHILD_DEV_DOMAINS[1].items),\n                calculateDomainAvg('cognitive', CHILD_DEV_DOMAINS[2].items),\n                calculateDomainAvg('socio', CHILD_DEV_DOMAINS[3].items),\n                calculateDomainAvg('rhythm', CHILD_MUSICAL_PROFILE[0].items), // Simplified for the 5-axis radar\n            ];\n        }\n\n        onSave({\n            date: formatDateForDisplay(date),\n            moca: `${mocaTotal}/30`,\n            mmse: `${mmseTotal}/30`,\n            gds: gdsValue,\n            functionalScores: isChild ? childRadarScores : functionalScores,\n            mocaDetails,\n            mmseDetails,\n            childProfile,\n            childObs,\n        } as unknown as CognitiveScores);\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white w-full max-w-5xl rounded-3xl shadow-3d max-h-[90vh] flex flex-col overflow-hidden animate-in fade-in zoom-in-95\">\n                {/* Header Unificado */}\n                <div className=\"p-6 border-b flex justify-between items-center bg-white sticky top-0 z-10\">\n                    <div className=\"flex items-center gap-4\">\n                        <div\n                            className={`p-3 rounded-2xl ${isChild ? 'bg-indigo-100 text-indigo-600' : 'bg-pink-100 text-pink-600'}`}\n                        >\n                            {isChild ? <Baby size={28} /> : <Brain size={28} />}\n                        </div>\n                        <div>\n                            <h2 className=\"text-2xl font-black text-slate-800\">\n                                {isChild ? 'Perfil de Desarrollo' : isGeriatric ? 'ValoraciÃ³n GeriÃ¡trica' : 'EvaluaciÃ³n Psicosocial'}\n                            </h2>\n                            <p className=\"text-slate-500 text-sm font-medium\">EvaluaciÃ³n ClÃ­nica Integral</p>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"text-right\">\n                            <label className=\"block text-[10px] font-bold uppercase text-slate-400\">\n                                Fecha EvaluaciÃ³n\n                            </label>\n                            <input\n                                type=\"date\"\n                                value={date}\n                                onChange={(e) => setDate(e.target.value)}\n                                className=\"font-bold text-slate-700 bg-transparent border-none text-right focus:ring-0 p-0 outline-none w-32\"\n                            />\n                        </div>\n                        <button\n                            onClick={onClose}\n                            className=\"p-2 hover:bg-slate-100 rounded-full transition-colors\"\n                        >\n                            <X size={24} />\n                        </button>\n                    </div>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto bg-slate-50/50 p-8 custom-scrollbar\">\n                    {/* TABS NAVIGATION */}\n                    <div className=\"flex border-b border-slate-200 mb-6 bg-white rounded-xl shadow-sm overflow-hidden\">\n                        {[\n                            { id: 'general', label: isChild ? 'Perfil de Desarrollo' : 'Resumen & Funcional' },\n                            ...(isChild || !isGeriatric\n                                ? []\n                                : [\n                                    { id: 'moca', label: 'MOCA (Detallado)' },\n                                    { id: 'mmse', label: 'MMSE (Detallado)' },\n                                ]),\n                        ].map((tab) => (\n                            <button\n                                key={tab.id}\n                                onClick={() => setActiveTab(tab.id as any)}\n                                className={`flex-1 py-3 text-sm font-bold transition-all ${activeTab === tab.id ? 'bg-pink-50 text-pink-700 border-b-2 border-pink-500' : 'text-slate-500 hover:text-slate-700 hover:bg-slate-50'}`}\n                            >\n                                {tab.label}\n                            </button>\n                        ))}\n                    </div>\n\n                    <form\n                        id=\"evalForm\"\n                        onSubmit={(e) => {\n                            e.preventDefault();\n                            handleSave();\n                        }}\n                        className=\"space-y-8\"\n                    >\n                        {/* --- VISTA ADULTO: Dashboard MÃ©tricas + Funcional --- */}\n                        {!isChild && activeTab === 'general' && (\n                            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                                {/* Columna Izquierda: MÃ©tricas Hard (MOCA/MMSE) - ONLY GERIATRIC */}\n                                {isGeriatric ? (\n                                    <div className=\"space-y-6\">\n                                        <div className=\"bg-white p-6 rounded-2xl border border-slate-100 shadow-sm\">\n                                            <h3 className=\"font-black text-slate-800 mb-4 flex items-center gap-2\">\n                                                <Activity size={18} className=\"text-pink-500\" /> Screening Cognitivo\n                                            </h3>\n\n                                            <div className=\"space-y-6\">\n                                                {/* MOCA Summary */}\n                                                <div\n                                                    className=\"bg-slate-50 rounded-xl p-4 border border-slate-200 cursor-pointer hover:bg-slate-100 transition-colors\"\n                                                    onClick={() => setActiveTab('moca')}\n                                                >\n                                                    <div className=\"flex justify-between items-center\">\n                                                        <span className=\"font-bold text-slate-700\">MOCA</span>\n                                                        <span className=\"text-2xl font-black text-pink-600\">\n                                                            {mocaTotal}\n                                                            <span className=\"text-sm text-slate-400 font-medium\">/30</span>\n                                                        </span>\n                                                    </div>\n                                                    <div className=\"text-xs text-slate-400 mt-1 font-medium text-right\">\n                                                        Ver detalle &rarr;\n                                                    </div>\n                                                </div>\n\n                                                {/* MMSE Summary */}\n                                                <div\n                                                    className=\"bg-slate-50 rounded-xl p-4 border border-slate-200 cursor-pointer hover:bg-slate-100 transition-colors\"\n                                                    onClick={() => setActiveTab('mmse')}\n                                                >\n                                                    <div className=\"flex justify-between items-center\">\n                                                        <span className=\"font-bold text-slate-700\">MMSE</span>\n                                                        <span className=\"text-2xl font-black text-blue-600\">\n                                                            {mmseTotal}\n                                                            <span className=\"text-sm text-slate-400 font-medium\">/30</span>\n                                                        </span>\n                                                    </div>\n                                                    <div className=\"text-xs text-slate-400 mt-1 font-medium text-right\">\n                                                        Ver detalle &rarr;\n                                                    </div>\n                                                </div>\n\n                                                {/* GDS Card */}\n                                                <GDSSelector value={gdsValue} onChange={setGdsValue} />\n                                            </div>\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-6\">\n                                        <div className=\"bg-emerald-50 p-6 rounded-2xl border border-emerald-100 shadow-sm\">\n                                            <h3 className=\"font-black text-emerald-800 mb-4 flex items-center gap-2\">\n                                                <Brain size={18} /> EvaluaciÃ³n Psicosocial\n                                            </h3>\n                                            <p className=\"text-sm text-emerald-700 mb-4\">\n                                                Enfoque en bienestar emocional, adaptaciÃ³n y funcionalidad social.\n                                            </p>\n                                            {/* Could add specific adult scales here later */}\n                                        </div>\n                                    </div>\n                                )}\n\n                                {/* Columna Derecha: Mapa Funcional (Visual Cards - The \"Child\" Style adapted for Adults) */}\n                                <div className=\"lg:col-span-2 space-y-6\">\n                                    <h3 className=\"font-black text-slate-800 flex items-center gap-2\">\n                                        <Activity size={18} className=\"text-indigo-500\" /> Perfil Funcional & Musical\n                                    </h3>\n\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                        {/* Import ADULT_DEV_DOMAINS inside the file imports first, but for now assuming it's available or I'll add import */}\n                                        {ADULT_DEV_DOMAINS.map((domain) => {\n                                            const DomainIcon = domain.icon;\n                                            const colorClasses: Record<string, string> = {\n                                                blue: 'bg-blue-50 border-blue-100 text-blue-700',\n                                                emerald: 'bg-emerald-50 border-emerald-100 text-emerald-700',\n                                                purple: 'bg-purple-50 border-purple-100 text-purple-700',\n                                                rose: 'bg-rose-50 border-rose-100 text-rose-700',\n                                            };\n\n                                            return (\n                                                <div\n                                                    key={domain.id}\n                                                    className=\"bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden group hover:shadow-md transition-all\"\n                                                >\n                                                    <div\n                                                        className={`p-4 border-b border-slate-100 flex items-center gap-3 ${colorClasses[domain.color]}`}\n                                                    >\n                                                        <DomainIcon size={20} />\n                                                        <h3 className=\"font-bold text-lg\">{domain.title}</h3>\n                                                    </div>\n                                                    <div className=\"p-5 space-y-5\">\n                                                        {domain.items.map((item) => {\n                                                            // Find index in EVALUATION_AREAS_ADULT\n                                                            const idx = EVALUATION_AREAS_ADULT.indexOf(item);\n                                                            // If not found, skip or handle error (should be found if constants are synced)\n                                                            if (idx === -1) return null;\n\n                                                            const currentVal = functionalScores[idx] || 0;\n\n                                                            return (\n                                                                <div key={item}>\n                                                                    <div className=\"flex justify-between items-center mb-2\">\n                                                                        <span className=\"text-sm font-medium text-slate-700\">{item}</span>\n                                                                        <span\n                                                                            className={`text-[10px] font-black uppercase tracking-wide ${currentVal === 3 ? 'text-emerald-600' : currentVal === 2 ? 'text-blue-600' : currentVal === 1 ? 'text-yellow-600' : 'text-slate-300'}`}\n                                                                        >\n                                                                            {currentVal === 0 ? 'Nulo' : currentVal === 1 ? 'Bajo' : currentVal === 2 ? 'Medio' : 'Alto'}\n                                                                        </span>\n                                                                    </div>\n                                                                    {/* Interactive Progress Bar */}\n                                                                    <div className=\"flex gap-1 h-3 cursor-pointer group/bar\">\n                                                                        {[0, 1, 2, 3].map((level) => {\n                                                                            let barColor = 'bg-slate-100';\n                                                                            if (level > 0 && currentVal >= level) {\n                                                                                if (level === 1) barColor = 'bg-yellow-400';\n                                                                                if (level === 2) barColor = 'bg-blue-400';\n                                                                                if (level === 3) barColor = 'bg-emerald-400';\n                                                                            }\n                                                                            return (\n                                                                                <div\n                                                                                    key={level}\n                                                                                    onClick={() => {\n                                                                                        const n = [...functionalScores];\n                                                                                        n[idx] = level;\n                                                                                        setFunctionalScores(n);\n                                                                                    }}\n                                                                                    className={`flex-1 rounded-sm transition-all hover:opacity-80 ${barColor} ${level === 0 ? 'hidden' : ''}`}\n                                                                                />\n                                                                            );\n                                                                        })}\n                                                                        <div\n                                                                            onClick={() => {\n                                                                                const n = [...functionalScores];\n                                                                                n[idx] = 0;\n                                                                                setFunctionalScores(n);\n                                                                            }}\n                                                                            className=\"w-4 h-full bg-slate-50 hover:bg-red-100 rounded-sm ml-2 flex items-center justify-center text-[8px] text-slate-300 cursor-pointer\"\n                                                                            title=\"Reset\"\n                                                                        >\n                                                                            x\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                    </div>\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n\n                                    <div className=\"md:col-span-2 mt-6\">\n                                        <label className=\"label-pro mb-3\">Observaciones y Conclusiones ClÃ­nicas</label>\n                                        <textarea\n                                            value={childObs}\n                                            onChange={(e) => setChildObs(e.target.value)}\n                                            className=\"input-pro h-32 resize-none bg-slate-50 border-slate-200\"\n                                            placeholder=\"SÃ­ntesis cualitativa del perfil, fortalezas y necesidades de apoyo...\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* --- VISTA MOCA DETALLADO --- */}\n                        {!isChild && activeTab === 'moca' && (\n                            <div className=\"animate-in fade-in max-w-2xl mx-auto space-y-6\">\n                                <div className=\"flex items-center gap-4 border-b pb-4 mb-6\">\n                                    <button\n                                        type=\"button\"\n                                        onClick={() => setActiveTab('general')}\n                                        className=\"p-2 hover:bg-slate-100 rounded-lg\"\n                                    >\n                                        <Activity size={20} />\n                                    </button>\n                                    <div>\n                                        <h3 className=\"font-black text-slate-800 text-xl\">EvaluaciÃ³n MOCA</h3>\n                                        <p className=\"text-sm text-slate-500\">Montreal Cognitive Assessment</p>\n                                    </div>\n                                    <div className=\"ml-auto text-2xl font-black text-pink-600 bg-pink-50 px-4 py-2 rounded-xl\">\n                                        {mocaTotal}/30\n                                    </div>\n                                </div>\n                                <div className=\"grid grid-cols-1 gap-4\">\n                                    {MOCA_SECTIONS.map((s) => (\n                                        <div\n                                            key={s.id}\n                                            className=\"bg-white p-4 rounded-xl border border-slate-200 flex justify-between items-center shadow-sm\"\n                                        >\n                                            <div className=\"flex-1\">\n                                                <label className=\"font-bold text-slate-700 block\">{s.label}</label>\n                                                <span className=\"text-xs text-slate-400\">PuntuaciÃ³n mÃ¡x: {s.max}</span>\n                                            </div>\n                                            <div className=\"flex items-center gap-2\">\n                                                <input\n                                                    type=\"number\"\n                                                    min=\"0\"\n                                                    max={s.max}\n                                                    value={mocaDetails[s.id] || ''}\n                                                    onChange={(e) =>\n                                                        setMocaDetails({\n                                                            ...mocaDetails,\n                                                            [s.id]: parseInt(e.target.value) || 0,\n                                                        })\n                                                    }\n                                                    className=\"w-16 h-12 text-center text-xl font-black bg-slate-50 border-2 border-slate-200 rounded-lg focus:border-pink-500 focus:outline-none transition-colors\"\n                                                />\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* --- VISTA MMSE DETALLADO --- */}\n                        {!isChild && activeTab === 'mmse' && (\n                            <div className=\"animate-in fade-in max-w-2xl mx-auto space-y-6\">\n                                <div className=\"flex items-center gap-4 border-b pb-4 mb-6\">\n                                    <button\n                                        type=\"button\"\n                                        onClick={() => setActiveTab('general')}\n                                        className=\"p-2 hover:bg-slate-100 rounded-lg\"\n                                    >\n                                        <Activity size={20} />\n                                    </button>\n                                    <div>\n                                        <h3 className=\"font-black text-slate-800 text-xl\">EvaluaciÃ³n MMSE</h3>\n                                        <p className=\"text-sm text-slate-500\">Mini-Mental State Examination</p>\n                                    </div>\n                                    <div className=\"ml-auto text-2xl font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-xl\">\n                                        {mmseTotal}/30\n                                    </div>\n                                </div>\n                                <div className=\"grid grid-cols-1 gap-4\">\n                                    {MMSE_SECTIONS.map((s) => (\n                                        <div\n                                            key={s.id}\n                                            className=\"bg-white p-4 rounded-xl border border-slate-200 flex justify-between items-center shadow-sm\"\n                                        >\n                                            <div className=\"flex-1\">\n                                                <label className=\"font-bold text-slate-700 block\">{s.label}</label>\n                                                <span className=\"text-xs text-slate-400\">PuntuaciÃ³n mÃ¡x: {s.max}</span>\n                                            </div>\n                                            <div className=\"flex items-center gap-2\">\n                                                <input\n                                                    type=\"number\"\n                                                    min=\"0\"\n                                                    max={s.max}\n                                                    value={mmseDetails[s.id] || ''}\n                                                    onChange={(e) =>\n                                                        setMmseDetails({\n                                                            ...mmseDetails,\n                                                            [s.id]: parseInt(e.target.value) || 0,\n                                                        })\n                                                    }\n                                                    className=\"w-16 h-12 text-center text-xl font-black bg-slate-50 border-2 border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors\"\n                                                />\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* --- VISTA NIÃ‘O: Tarjetas Visuales de Desarrollo --- */}\n                        {isChild && (\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 animate-in fade-in\">\n                                {[\n                                    ...CHILD_DEV_DOMAINS,\n                                    {\n                                        id: 'musical',\n                                        title: 'Perfil Musical',\n                                        icon: Music,\n                                        color: 'pink',\n                                        items: CHILD_MUSICAL_PROFILE.flatMap((p) => p.items),\n                                    },\n                                ].map((domain) => {\n                                    const DomainIcon = domain.icon;\n                                    // Map color names to tailwind classes explicitly\n                                    const colorClasses: Record<string, string> = {\n                                        blue: 'bg-blue-50 border-blue-100 text-blue-700',\n                                        emerald: 'bg-emerald-50 border-emerald-100 text-emerald-700',\n                                        purple: 'bg-purple-50 border-purple-100 text-purple-700',\n                                        rose: 'bg-rose-50 border-rose-100 text-rose-700',\n                                        pink: 'bg-pink-50 border-pink-100 text-pink-700',\n                                    };\n\n                                    return (\n                                        <div\n                                            key={domain.id}\n                                            className=\"bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden group hover:shadow-md transition-all\"\n                                        >\n                                            <div\n                                                className={`p-4 border-b border-slate-100 flex items-center gap-3 ${colorClasses[domain.color]}`}\n                                            >\n                                                <DomainIcon size={20} />\n                                                <h3 className=\"font-bold text-lg\">{domain.title}</h3>\n                                            </div>\n                                            <div className=\"p-5 space-y-5\">\n                                                {domain.items.map((item) => {\n                                                    // Handle musical profile structure flattening or direct access\n                                                    const domKey =\n                                                        domain.id === 'musical'\n                                                            ? CHILD_MUSICAL_PROFILE.find((cat) => cat.items.includes(item))?.id ||\n                                                            'rhythm'\n                                                            : domain.id;\n\n                                                    const currentVal = childProfile[domKey]?.[item] ?? 0;\n\n                                                    return (\n                                                        <div key={item}>\n                                                            <div className=\"flex justify-between items-center mb-2\">\n                                                                <span className=\"text-sm font-medium text-slate-700\">{item}</span>\n                                                                <span\n                                                                    className={`text-[10px] font-black uppercase tracking-wide ${currentVal === 3 ? 'text-emerald-600' : currentVal === 2 ? 'text-blue-600' : currentVal === 1 ? 'text-yellow-600' : 'text-slate-300'}`}\n                                                                >\n                                                                    {CHILD_LEVELS[currentVal].label}\n                                                                </span>\n                                                            </div>\n                                                            {/* Interactive Progress Bar */}\n                                                            <div className=\"flex gap-1 h-3 cursor-pointer group/bar\">\n                                                                {[0, 1, 2, 3].map((level) => {\n                                                                    let barColor = 'bg-slate-100';\n                                                                    if (level > 0 && currentVal >= level) {\n                                                                        if (level === 1) barColor = 'bg-yellow-400';\n                                                                        if (level === 2) barColor = 'bg-blue-400';\n                                                                        if (level === 3) barColor = 'bg-emerald-400';\n                                                                    }\n                                                                    return (\n                                                                        <div\n                                                                            key={level}\n                                                                            onClick={() => updateChildProfile(domKey, item, level)}\n                                                                            className={`flex-1 rounded-sm transition-all hover:opacity-80 ${barColor} ${level === 0 ? 'hidden' : ''}`} // Hide 0 bar, show 1-3\n                                                                        />\n                                                                    );\n                                                                })}\n                                                                {/* Helper click area for 0 (reset) */}\n                                                                <div\n                                                                    onClick={() => updateChildProfile(domKey, item, 0)}\n                                                                    className=\"w-4 h-full bg-slate-50 hover:bg-red-100 rounded-sm ml-2 flex items-center justify-center text-[8px] text-slate-300 cursor-pointer\"\n                                                                    title=\"Reset\"\n                                                                >\n                                                                    x\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                                <div className=\"md:col-span-2\">\n                                    <label className=\"label-pro mb-3\">Observaciones y Conclusiones</label>\n                                    <textarea\n                                        value={childObs}\n                                        onChange={(e) => setChildObs(e.target.value)}\n                                        className=\"input-pro h-32 resize-none bg-slate-50 border-slate-200\"\n                                        placeholder=\"SÃ­ntesis cualitativa del perfil de desarrollo...\"\n                                    />\n                                </div>\n                            </div>\n                        )}\n                    </form>\n                </div>\n                <div className=\"p-6 border-t bg-white flex justify-end gap-3 sticky bottom-0 z-10\">\n                    <Button variant=\"ghost\" onClick={onClose} type=\"button\">\n                        Cancelar\n                    </Button>\n                    <Button\n                        onClick={() => {\n                            // Manual submit trigger\n                            const event = new Event('submit', { cancelable: true, bubbles: true });\n                            document.getElementById('evalForm')?.dispatchEvent(event);\n                        }}\n                        className=\"px-8\"\n                    >\n                        {isChild ? 'Guardar Perfil' : 'Guardar EvaluaciÃ³n'}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\CreateGroupModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\EditProfileModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\MusicalIdentityModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\ReportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4017,4020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4017,4020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\ReportModal.tsx:118:7\n  116 |\n  117 |       // eslint-disable-next-line react-hooks/set-state-in-effect\n> 118 |       setReportText(draft);\n      |       ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  119 |\n  120 |       setIsGenerating(false);\n  121 |     }","line":118,"column":7,"nodeType":null,"endLine":118,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useRef } from 'react';\nimport { X, FileText, Printer, Wand2 } from 'lucide-react';\nimport { Button } from '../../../components/ui/Button';\nimport { Patient, ClinicSettings } from '../../../lib/types';\nimport logoCircular from '../../../assets/logo-circular.png';\nimport { useActivityLog } from '../../../hooks/useActivityLog';\nimport { PATHOLOGY_MAP } from '../../../lib/patientUtils';\nimport { EVALUATION_AREAS_CHILD, EVALUATION_AREAS_ADULT } from '../../../lib/constants';\nimport { useReactToPrint, UseReactToPrintOptions } from 'react-to-print';\n\ninterface ReportModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  patient: Patient;\n  clinicSettings: ClinicSettings;\n}\n\nexport const ReportModal: React.FC<ReportModalProps> = ({\n  isOpen,\n  onClose,\n  patient,\n  clinicSettings,\n}) => {\n  const [reportText, setReportText] = useState('');\n  const [isGenerating, setIsGenerating] = useState(true);\n  const { logActivity } = useActivityLog();\n\n  // PRINT REF\n  const reportRef = useRef<HTMLDivElement>(null);\n\n  const handlePrint = useReactToPrint({\n    content: () => reportRef.current,\n    documentTitle: `Informe_Clinico_${patient.name.replace(/\\s+/g, '_')}`,\n    removeAfterPrint: true,\n    onAfterPrint: () => logActivity('report', `Informe clÃ­nico generado para: ${patient.name}`),\n  } as UseReactToPrintOptions);\n\n\n  // Smart Template Logic (Refactored: Robust & Instant)\n  useEffect(() => {\n    if (isOpen && patient && !reportText) {\n      // Determine Type and Mapping\n      const isChild = patient.age < 18;\n      const labels = isChild ? EVALUATION_AREAS_CHILD : EVALUATION_AREAS_ADULT;\n      const scores = patient.currentEval || [];\n\n      const functionalText = scores.length > 0\n        ? labels.map((label: string, idx: number) => {\n          const score = scores[idx] || 0;\n          const level = score === 0 ? 'Nulo/No Evaluado' : score === 1 ? 'Bajo/Emergente' : score === 2 ? 'Medio/En Proceso' : 'Alto/Consolidado';\n          if (score === 0) return null; // Skip empty\n          return `- ${label}: ${level}`;\n        }).filter(Boolean).join('\\n')\n        : 'Sin registro funcional detallado.';\n\n      const today = new Date().toLocaleDateString('es-ES', {\n        day: 'numeric',\n        month: 'long',\n        year: 'numeric',\n      });\n      const sessionsCount = patient.sessions?.filter((s) => !s.isAbsent).length || 0;\n      const lastEval = patient.cognitiveScores || {};\n      const mocaScore = lastEval.moca || 'Pendiente';\n      const gdsScore = lastEval.gds || 'No registrado';\n\n      const synthesisText = typeof patient.clinicalFormulation?.synthesis === 'string'\n        ? patient.clinicalFormulation.synthesis\n        : patient.clinicalFormulation?.synthesis?.text;\n\n      const draft = `INFORME CLÃNICO DE MUSICOTERAPIA\nFecha de emisiÃ³n: ${today}\n\n1. DATOS DE FILIACIÃ“N\nPaciente: ${patient.name}\nEdad: ${patient.age} aÃ±os\nDiagnÃ³stico: ${patient.diagnosis}\nReferencia HC: ${patient.reference || 'N/A'}\n\n2. RESUMEN DE INTERVENCIÃ“N\nEl paciente iniciÃ³ el tratamiento el ${patient.joinedDate}. A fecha de hoy, ha completado un total de ${sessionsCount} sesiones de musicoterapia.\nActualmente se encuentra en una fase de mantenimiento y estimulaciÃ³n cognitiva activa.\n\n3. EVALUACIÃ“N Y EVOLUCIÃ“N\nEn la Ãºltima valoraciÃ³n psicomÃ©trica y funcional realizada, se obtuvieron los siguientes resultados:\n\nPERFIL COGNITIVO / SCREENING:\n- MOCA (Montreal Cognitive Assessment): ${mocaScore}\n- Escala GDS (Reisberg): Estadio ${gdsScore}\n\nPERFIL FUNCIONAL Y MUSICAL:\n${functionalText}\n\nEVOLUCIÃ“N RECIENTE (Ãšltimas 5 Sesiones):\n${patient.sessions\n          ?.slice(0, 5)\n          .map(s => {\n            const status = s.isAbsent ? '[AUSENCIA]' : '';\n            return `- ${s.date} ${status}: ${s.notes || (s.computedPhase ? 'Fase ' + s.computedPhase : 'SesiÃ³n EstÃ¡ndar')}`;\n          })\n          .join('\\n') || 'Sin sesiones recientes.'\n        }\n\nObservaciones cualitativas:\n${synthesisText || ((patient.cognitiveScores as unknown as Record<string, any>)?.childObs || 'No se han registrado observaciones especÃ­ficas.')}\n\n4. OBJETIVOS TRABAJADOS\n- EstimulaciÃ³n de la memoria autobiogrÃ¡fica a travÃ©s de la reminiscencia musical.\n- Fomento de la iniciativa y la comunicaciÃ³n verbal.\n- Mantenimiento de las capacidades atencionales y funciones ejecutivas.\n\n5. CONCLUSIONES Y RECOMENDACIONES\nSe observa una respuesta favorable a la intervenciÃ³n musical...[Espacio para que el terapeuta complete]\n\nSe recomienda la continuidad del tratamiento con una frecuencia de...`;\n\n      // eslint-disable-next-line react-hooks/set-state-in-effect\n      setReportText(draft);\n\n      setIsGenerating(false);\n    }\n  }, [isOpen, patient, reportText]);\n\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white w-full max-w-4xl rounded-2xl shadow-2xl h-[85vh] flex flex-col animate-in fade-in zoom-in-95\">\n        <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50\">\n          <div>\n            <h2 className=\"text-xl font-black text-slate-800 flex items-center gap-3\">\n              <FileText className=\"text-pink-600\" /> Generador de Informe ClÃ­nico\n            </h2>\n            <p className=\"text-sm text-slate-500\">Asistente de redacciÃ³n inteligente v5.0</p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-slate-200 rounded-full transition-colors\"\n          >\n            <X size={20} />\n          </button>\n        </div>\n\n        <div className=\"flex-1 flex flex-col md:flex-row h-full overflow-hidden\">\n          {/* Left Panel: Context & Template */}\n          <div className=\"w-full md:w-1/3 bg-slate-50 border-r border-slate-200 p-6 overflow-y-auto hidden md:block\">\n            <div className=\"bg-pink-50 border border-pink-100 rounded-xl p-4 mb-6\">\n              <h4 className=\"font-bold text-pink-700 text-sm mb-2 flex items-center gap-2\">\n                <Wand2 size={16} /> Smart Template Activo\n              </h4>\n              <p className=\"text-xs text-pink-600 leading-relaxed\">\n                El sistema ha detectado {patient.sessions?.length || 0} sesiones y una evaluaciÃ³n\n                reciente. Se ha generado un borrador basado en la fase \"{PATHOLOGY_MAP[patient.pathologyType] || patient.pathologyType}\" del\n                paciente.\n              </p>\n            </div>\n\n            <h4 className=\"font-bold text-slate-700 text-sm mb-3 uppercase tracking-wider\">\n              Variables Inyectadas\n            </h4>\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center text-xs p-2 bg-white rounded border border-slate-200\">\n                <span className=\"text-slate-500\">Paciente</span>\n                <span className=\"font-bold text-slate-800\">{patient.name}</span>\n              </div>\n              <div className=\"flex justify-between items-center text-xs p-2 bg-white rounded border border-slate-200\">\n                <span className=\"text-slate-500\">Edad</span>\n                <span className=\"font-bold text-slate-800\">{patient.age}</span>\n              </div>\n              <div className=\"flex justify-between items-center text-xs p-2 bg-white rounded border border-slate-200\">\n                <span className=\"text-slate-500\">MOCA</span>\n                <span className=\"font-bold text-slate-800\">\n                  {patient.cognitiveScores?.moca || '-'}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Right Panel: Editor */}\n          <div className=\"flex-1 flex flex-col relative\">\n            {isGenerating && (\n              <div className=\"absolute inset-0 bg-white/80 z-10 flex items-center justify-center flex-col gap-3\">\n                <Wand2 className=\"animate-spin text-pink-500\" size={32} />\n                <span className=\"text-sm font-bold text-slate-500\">\n                  Redactando borrador clÃ­nico...\n                </span>\n              </div>\n            )}\n            <textarea\n              className=\"flex-1 p-8 resize-none focus:outline-none font-serif text-slate-800 leading-relaxed\"\n              value={reportText}\n              onChange={(e) => setReportText(e.target.value)}\n            />\n          </div>\n        </div>\n\n        <div className=\"p-4 border-t border-slate-100 bg-white flex justify-end gap-3\">\n          <Button variant=\"secondary\" onClick={onClose}>\n            Cancelar\n          </Button>\n          <Button onClick={handlePrint} icon={Printer}>\n            Imprimir / Guardar PDF\n          </Button>\n        </div>\n      </div>\n\n      {/* HIDDEN PRINT TEMPLATE - RENDERED IN DOM BUT HIDDEN */}\n      <div style={{ display: 'none' }}>\n        <div ref={reportRef} className=\"print-container p-10 font-serif text-slate-800 leading-relaxed\" style={{ padding: '40px', fontFamily: '\"Times New Roman\", serif', color: '#333' }}>\n          <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '2px solid #EC008C', paddingBottom: '20px', marginBottom: '40px' }}>\n            <img src={logoCircular} style={{ height: '60px' }} alt=\"Logo\" />\n            <div style={{ textAlign: 'right', fontSize: '12px', color: '#666' }}>\n              <strong>{clinicSettings.name || 'ClÃ­nica MÃ©todo Activa'}</strong><br />\n              {clinicSettings.address || ''}<br />\n              {clinicSettings.email || ''} | {clinicSettings.phone || ''}\n            </div>\n          </div>\n\n          <pre style={{ whiteSpace: 'pre-wrap', fontFamily: 'inherit', fontSize: '14px' }}>{reportText}</pre>\n\n          <div style={{ marginTop: '60px', display: 'flex', justifyContent: 'space-between' }}>\n            <div style={{ textAlign: 'center' }}>\n              <div style={{ width: '200px', borderTop: '1px solid #000', marginBottom: '5px' }}></div>\n              Fdo. El Terapeuta\n            </div>\n            <div style={{ textAlign: 'center' }}>\n              <div style={{ width: '200px', borderTop: '1px solid #000', marginBottom: '5px' }}></div>\n              VÂºBÂº DirecciÃ³n\n            </div>\n          </div>\n\n          <div style={{ marginTop: '50px', borderTop: '1px solid #ccc', paddingTop: '20px', textAlign: 'center', fontSize: '10px', color: '#999' }}>\n            Documento generado automÃ¡ticamente por MÃ©todo Activa Clinical OS v5.0<br />\n            {clinicSettings.legalText || ''}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\SafetyModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6312,6315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6312,6315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport {\n    ShieldAlert,\n    AlertTriangle,\n    HeartPulse,\n    CheckCircle2,\n    X,\n    ShieldCheck\n} from 'lucide-react';\nimport { ClinicalSafetyProfile } from '../../../lib/types';\nimport { Button } from '../../../components/ui/Button';\n\ninterface SafetyModalProps {\n    onClose: () => void;\n    onSave: (data: ClinicalSafetyProfile) => void;\n    initialData?: ClinicalSafetyProfile;\n    isChild?: boolean;\n}\n\nexport const SafetyModal: React.FC<SafetyModalProps> = ({\n    onClose,\n    onSave,\n    initialData,\n    isChild = false,\n}) => {\n    const [safety, setSafety] = useState<ClinicalSafetyProfile>(\n        initialData || {\n            epilepsy: false,\n            dysphagia: false,\n            flightRisk: false,\n            psychomotorAgitation: false,\n            hyperacusis: false,\n            chokingHazard: false,\n            disruptiveBehavior: false,\n            alerts: [],\n            mobilityAid: 'none',\n            allergies: '',\n        },\n    );\n\n    const toggleSafety = (field: keyof ClinicalSafetyProfile) => {\n        setSafety((prev) => ({ ...prev, [field]: !prev[field] }));\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-2 md:p-4\">\n            <div className=\"bg-white w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col animate-in fade-in zoom-in-95 max-h-[90vh]\">\n                {/* HEADER */}\n                <div className=\"bg-red-50 p-6 flex justify-between items-center shrink-0 rounded-t-2xl border-b border-red-100\">\n                    <div>\n                        <h2 className=\"text-xl font-black flex items-center gap-2 text-red-800\">\n                            <ShieldAlert className=\"text-red-600\" size={24} />\n                            Seguridad ClÃ­nica\n                        </h2>\n                        <p className=\"text-red-600/70 text-sm mt-0.5 font-medium\">\n                            Protocolo de Riesgos y Asistencia FÃ­sica\n                        </p>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"p-2 hover:bg-red-100 rounded-full transition-colors text-red-400 hover:text-red-700\"\n                    >\n                        <X size={24} />\n                    </button>\n                </div>\n\n                {/* BODY */}\n                <div className=\"flex-1 overflow-y-auto p-6 space-y-8\">\n\n                    {/* 1. ALERTAS */}\n                    <section>\n                        <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-3 flex items-center gap-2\">\n                            <AlertTriangle size={14} /> Alertas CrÃ­ticas (SemÃ¡foro Rojo)\n                        </h3>\n                        <div className=\"grid grid-cols-2 gap-3\">\n                            {!isChild && (\n                                <>\n                                    <RiskToggle\n                                        label=\"Riesgo Fuga\"\n                                        desc=\"DeambulaciÃ³n errante\"\n                                        active={safety.flightRisk}\n                                        onClick={() => toggleSafety('flightRisk')}\n                                    />\n                                    <RiskToggle\n                                        label=\"Disfagia\"\n                                        desc=\"Riesgo AspiraciÃ³n\"\n                                        active={safety.dysphagia}\n                                        onClick={() => toggleSafety('dysphagia')}\n                                    />\n                                </>\n                            )}\n                            <RiskToggle\n                                label=\"Epilepsia\"\n                                desc=\"Crisis convulsivas\"\n                                active={safety.epilepsy}\n                                onClick={() => toggleSafety('epilepsy')}\n                            />\n                            <RiskToggle\n                                label=\"AgitaciÃ³n\"\n                                desc=\"Conducta agresiva\"\n                                active={safety.psychomotorAgitation}\n                                onClick={() => toggleSafety('psychomotorAgitation')}\n                            />\n                            {isChild && (\n                                <>\n                                    <RiskToggle\n                                        label=\"Hiperacusia\"\n                                        desc=\"Sensibilidad Auditiva\"\n                                        active={safety.hyperacusis}\n                                        onClick={() => toggleSafety('hyperacusis')}\n                                    />\n                                    <RiskToggle\n                                        label=\"Atragantar\"\n                                        desc=\"Pica / Ingesta objetos\"\n                                        active={safety.chokingHazard}\n                                        onClick={() => toggleSafety('chokingHazard')}\n                                    />\n                                </>\n                            )}\n                        </div>\n                    </section>\n\n                    {/* 2. MOVILIDAD */}\n                    <section>\n                        <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-3 flex items-center gap-2\">\n                            <HeartPulse size={14} /> Movilidad y Asistencia\n                        </h3>\n                        <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-2\">\n                            {[\n                                { val: 'none', label: 'AutÃ³noma' },\n                                { val: 'cane', label: 'BastÃ³n' },\n                                { val: 'walker', label: 'Andador' },\n                                { val: 'wheelchair', label: 'Silla Ruedas' },\n                                { val: 'bed', label: 'Encamado' },\n                            ].map((opt) => (\n                                <button\n                                    key={opt.val}\n                                    onClick={() => setSafety({ ...safety, mobilityAid: opt.val as any })}\n                                    className={`text-sm py-2 px-3 rounded-lg border font-medium transition-all ${safety.mobilityAid === opt.val\n                                        ? 'bg-red-600 text-white border-red-600 shadow-md transform scale-105'\n                                        : 'bg-white text-slate-600 border-slate-200 hover:border-red-300 hover:text-red-600'\n                                        }`}\n                                >\n                                    {opt.label}\n                                </button>\n                            ))}\n                        </div>\n                    </section>\n\n                    {/* 3. ALERGIAS */}\n                    <section>\n                        <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-3 flex items-center gap-2\">\n                            <ShieldCheck size={14} /> Alergias y Contraindicaciones\n                        </h3>\n                        <textarea\n                            className=\"w-full h-32 p-4 rounded-xl border-2 border-slate-200 focus:border-red-500 focus:ring-0 resize-none text-slate-700 bg-slate-50 text-sm leading-relaxed\"\n                            placeholder=\"Escriba aquÃ­ alergias severas (medicamentos, alimentos) o contraindicaciones importantes...\"\n                            value={safety.allergies || ''}\n                            onChange={(e) => setSafety({ ...safety, allergies: e.target.value })}\n                        />\n                    </section>\n\n                </div>\n\n                {/* FOOTER */}\n                <div className=\"p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3 shrink-0 rounded-b-2xl\">\n                    <Button variant=\"ghost\" onClick={onClose}>\n                        Cancelar\n                    </Button>\n                    <Button\n                        onClick={() => onSave(safety)}\n                        className=\"bg-red-600 hover:bg-red-700 text-white border-red-700 shadow-lg shadow-red-100\"\n                        icon={CheckCircle2}\n                    >\n                        Confirmar Seguridad\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst RiskToggle = ({ label, desc, active, onClick }: { label: string; desc: string; active: boolean; onClick: () => void }) => (\n    <div\n        onClick={onClick}\n        className={`p-3 rounded-xl border cursor-pointer transition-all active:scale-95 ${active\n            ? 'bg-red-50 border-red-500 ring-1 ring-red-500'\n            : 'bg-white border-slate-200 hover:border-red-200 hover:shadow-sm'\n            }`}\n    >\n        <div className=\"flex justify-between items-start mb-1\">\n            <h4 className={`font-bold text-sm ${active ? 'text-red-700' : 'text-slate-700'}`}>{label}</h4>\n            {active && <div className=\"w-2 h-2 rounded-full bg-red-500 animate-pulse\" />}\n        </div>\n        <p className=\"text-xs text-slate-400 leading-tight\">\n            {desc}\n        </p>\n    </div>\n);\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\modals\\SessionModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[807,810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[807,810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[947,950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[947,950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\tabs\\DocumentsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\titanium\\components\\ClinicalSummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\titanium\\components\\FinancialOverview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\titanium\\components\\PatientHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\patients\\titanium\\components\\SessionTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\reports\\ReportsView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2053,2056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2053,2056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card } from '../../components/ui/Card';\nimport { Button } from '../../components/ui/Button';\nimport { FileText, Download, Search, Filter, Calendar, AlertTriangle, Loader2 } from 'lucide-react';\nimport { useAuth } from '../../context/AuthContext';\n// Titanium Upgrade: New Controller\nimport { useReportController } from '../../hooks/controllers/useReportController';\n// import { ClinicalReport } from '../../lib/types';\n\nexport const ReportsView: React.FC = () => {\n    useAuth();\n    // TITANIUM CONTROLLER\n    const { reports, isLoading, isError, error } = useReportController(); // Global fetch\n\n    const [searchQuery, setSearchQuery] = useState('');\n    const [filterType, setFilterType] = useState<string>('all');\n\n    // Filter Logic\n    const filteredReports = reports.filter(report => {\n        const matchesSearch = (report.patientName || '').toLowerCase().includes(searchQuery.toLowerCase()) ||\n            (report.id || '').toLowerCase().includes(searchQuery.toLowerCase());\n        const matchesType = filterType === 'all' || report.type === filterType;\n        return matchesSearch && matchesType;\n    });\n\n    if (isLoading) return (\n        <div className=\"flex h-96 items-center justify-center\">\n            <Loader2 className=\"animate-spin text-slate-400\" size={32} />\n        </div>\n    );\n\n    if (isError) return (\n        <div className=\"p-8 text-center border-2 border-amber-100 bg-amber-50 rounded-2xl\">\n            <AlertTriangle className=\"mx-auto text-amber-500 mb-4\" size={48} />\n            <h3 className=\"text-lg font-bold text-amber-900\">Requiere ConfiguraciÃ³n</h3>\n            <p className=\"text-amber-700 mb-4\">\n                {(error as Error)?.message?.includes('Index')\n                    ? 'Falta el Ã­ndice \"Collection Group\" en Firebase. Contacta al administrador.'\n                    : 'Error al cargar los informes.'}\n            </p>\n            <p className=\"text-xs font-mono text-amber-600 bg-amber-100 p-2 rounded inline-block\">\n                {(error as any)?.message || 'Unknown Error'}\n            </p>\n        </div>\n    );\n\n    return (\n        <div className=\"max-w-7xl mx-auto animate-in fade-in space-y-6\">\n            <header className=\"flex flex-col md:flex-row justify-between items-center gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-black text-slate-900 tracking-tight\">\n                        Informes ClÃ­nicos\n                    </h1>\n                    <p className=\"text-slate-500 mt-1\">\n                        Repositorio central de documentaciÃ³n (Titanium View)\n                    </p>\n                </div>\n                {/* \n                <div className=\"flex gap-4\">\n                    <Button icon={Plus} onClick={handleCreateReport}>\n                        Nuevo Informe\n                    </Button>\n                </div> \n                */}\n            </header>\n\n            {/* Filters & Search */}\n            <Card className=\"p-4\">\n                <div className=\"flex flex-col md:flex-row gap-4 justify-between items-center\">\n                    <div className=\"relative flex-1 w-full md:w-auto\">\n                        <Search className=\"absolute left-3 top-3 text-slate-400\" size={18} />\n                        <input\n                            className=\"input-pro pl-10\"\n                            placeholder=\"Buscar por paciente o ref...\"\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                        />\n                    </div>\n                    <div className=\"flex gap-2 w-full md:w-auto overflow-x-auto\">\n                        {['all', 'initial', 'evolution', 'discharge'].map(type => (\n                            <button\n                                key={type}\n                                onClick={() => setFilterType(type)}\n                                className={`px - 4 py - 2 rounded - lg text - sm font - bold transition - colors whitespace - nowrap ${filterType === type\n                                    ? 'bg-slate-900 text-white'\n                                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                                    } `}\n                            >\n                                {type === 'all' ? 'Todos' : type.charAt(0).toUpperCase() + type.slice(1)}\n                            </button>\n                        ))}\n                    </div>\n                </div>\n            </Card>\n\n            {/* Reports List */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {filteredReports.map((report) => (\n                    <Card key={report.id} className=\"p-6 hover:shadow-lg transition-all group cursor-pointer border-l-4 border-l-purple-500\">\n                        <div className=\"flex justify-between items-start mb-4\">\n                            <div className=\"p-3 bg-purple-50 text-purple-600 rounded-xl\">\n                                <FileText size={24} />\n                            </div>\n                            <span className={`px - 2 py - 1 text - xs font - bold rounded uppercase ${report.status === 'final' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'\n                                } `}>\n                                {report.status || 'draft'}\n                            </span>\n                        </div>\n\n                        <h3 className=\"font-bold text-slate-900 text-lg mb-1\">{report.patientName || 'Sin Nombre'}</h3>\n                        <p className=\"text-xs text-slate-500 mb-4 font-mono\">{report.id} â€¢ {report.date || 'Sin fecha'}</p>\n\n                        <div className=\"space-y-2 text-sm text-slate-600 mb-6\">\n                            <div className=\"flex items-center gap-2\">\n                                <Filter size={14} />\n                                <span className=\"capitalize\">{report.type === 'initial' ? 'EvaluaciÃ³n Inicial' : report.type}</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                                <Calendar size={14} />\n                                <span>Generado por {report.generatedBy || 'Sistema'}</span>\n                            </div>\n                        </div>\n\n                        <div className=\"flex gap-2\">\n                            <Button variant=\"secondary\" size=\"sm\" className=\"w-full\" icon={Download}>\n                                Descargar PDF\n                            </Button>\n                        </div>\n                    </Card>\n                ))}\n            </div>\n\n            {filteredReports.length === 0 && (\n                <div className=\"text-center py-20 text-slate-400\">\n                    <FileText size={48} className=\"mx-auto mb-4 opacity-50\" />\n                    <p>No se encontraron informes. Los informes se crean desde la ficha del paciente.</p>\n                </div>\n            )}\n        </div>\n    );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\ClinicalGuideModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\ClinicalTemplates.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\DocumentationCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\templates\\GdsTemplate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\templates\\ManualClinicoAdultoHtml.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\templates\\ManualClinicoInfantilHtml.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\templates\\MmseTemplate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\resources\\templates\\MocaTemplate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\sessions\\CalendarView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\sessions\\GroupSessionsHistory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\sessions\\SessionsManager.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\sessions\\SessionsManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\sessions\\modals\\GroupSessionModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'groupName'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [groupName, initialGroupName]","fix":{"range":[1909,1927],"text":"[groupName, initialGroupName]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { X, Plus, Users, Activity, Zap, Heart, Trash2, Settings } from 'lucide-react';\nimport { Button } from '../../../components/ui/Button';\nimport { Patient, GroupSession } from '../../../lib/types';\n\ninterface GroupSessionModalProps {\n  onClose: () => void;\n  onSave: (data: GroupSession) => Promise<void> | void;\n  patients?: Patient[];\n  initialGroupName?: string;\n  mode?: 'schedule' | 'evolution';\n  initialData?: GroupSession; // Strict Type\n}\n\nexport const GroupSessionModal: React.FC<GroupSessionModalProps> = ({\n  onClose,\n  patients = [],\n  onSave,\n  initialGroupName = '',\n  mode = 'evolution',\n  initialData\n}) => {\n  // Store full participant objects { name, id? }\n  // On load, if initialData has names but no IDs, treat as guests\n  const [participants, setParticipants] = useState<{ name: string; id?: string }[]>(\n    // initialData?.participants is not in Type, rely on participantNames or passed props\n    initialData?.participantNames?.map((n: string) => ({ name: n })) ||\n    []\n  );\n\n  const [selectedPatientId, setSelectedPatientId] = useState('');\n  const [guestName, setGuestName] = useState('');\n  const [sessionPrice, setSessionPrice] = useState(initialData?.price || 150);\n\n  // Parse date safely\n  const defaultDate = initialData?.date || new Date().toISOString().split('T')[0];\n\n  const [date, setDate] = useState(defaultDate);\n  const [groupName, setGroupName] = useState(initialData?.groupName || initialGroupName);\n\n  // METRICS\n  const [engagementScore, setEngagementScore] = useState(initialData?.engagementScore || 5);\n  const [cohesionScore, setCohesionScore] = useState(initialData?.cohesionScore || 5);\n  const [energyLevel, setEnergyLevel] = useState<'High' | 'Medium' | 'Low'>(initialData?.energyLevel || 'Medium');\n\n  useEffect(() => {\n    if (initialGroupName && !groupName) setGroupName(initialGroupName);\n  }, [initialGroupName]);\n\n  const handleAddParticipant = () => {\n    // 1. Try add Real Patient\n    if (selectedPatientId) {\n      const patient = patients.find(p => p.id === selectedPatientId);\n      if (patient) {\n        if (!participants.some(p => p.id === patient.id)) {\n          setParticipants([...participants, { name: patient.name, id: String(patient.id) }]);\n        }\n        setSelectedPatientId('');\n        return;\n      }\n    }\n\n    // 2. Try add Guest\n    if (guestName.trim()) {\n      if (!participants.some(p => p.name.toLowerCase() === guestName.trim().toLowerCase())) {\n        setParticipants([...participants, { name: guestName.trim() }]);\n      }\n      setGuestName('');\n    }\n  };\n\n  const handleRemoveParticipant = (index: number) => {\n    setParticipants(participants.filter((_, i) => i !== index));\n  };\n\n  const isScheduleMode = mode === 'schedule';\n\n  const [showConfigMenu, setShowConfigMenu] = useState(false);\n\n  return (\n    <div className=\"fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4\">\n      <div className={`bg-white w-full ${isScheduleMode ? 'max-w-md' : 'max-w-5xl'} rounded-2xl shadow-3d p-6 animate-in fade-in zoom-in-95 flex flex-col max-h-[90vh] transition-all duration-300 relative`}>\n\n        {/* CONFIG MENU DROPDOWN */}\n        {showConfigMenu && (\n          <div className=\"absolute top-16 right-6 bg-white rounded-xl shadow-xl border border-slate-100 p-2 z-50 min-w-[200px] animate-in slide-in-from-top-2\">\n            <button\n              onClick={() => {\n                setShowConfigMenu(false);\n                // Already editing, maybe focus?\n                document.getElementById('groupNameInput')?.focus();\n              }}\n              className=\"w-full text-left px-4 py-3 hover:bg-slate-50 rounded-lg flex items-center gap-3 text-slate-700 font-bold text-sm transition-colors\"\n            >\n              <Users size={16} className=\"text-blue-500\" /> Editar Grupo\n            </button>\n            {/* DELETE OPTION - UNCONDITIONAL */}\n            {/* DELETE OPTION - ROBUST */}\n            <button\n              onClick={async () => {\n                // Try to find ID: standard 'id' or 'groupId' (if coming from patient record view)\n                const sessionId = initialData?.id || initialData?.groupId;\n\n                if (!sessionId) {\n                  if (confirm(\"Error de sincronizaciÃ³n: Falta el ID de la sesiÃ³n. \\n\\nÂ¿Quieres recargar la pÃ¡gina para corregir los datos automÃ¡ticamente?\")) {\n                    window.location.reload();\n                  }\n                  return;\n                }\n\n                if (confirm('Â¿EstÃ¡s seguro de eliminar esta sesiÃ³n y todos sus registros asociados? (AcciÃ³n irreversible)')) {\n                  try {\n                    const { GroupSessionRepository } = await import('../../../data/repositories/GroupSessionRepository');\n                    // Ensure we delete passing the correct ID string\n                    await GroupSessionRepository.delete(String(sessionId));\n                    alert('SesiÃ³n eliminada correctamente.');\n                    onClose();\n                    // Force reload to sync all views (legacy array cleanup relies on this or complex logic)\n                    window.location.reload();\n                  } catch (e) {\n                    console.error(e);\n                    alert('Error al eliminar: ' + (e as Error).message);\n                  }\n                }\n              }}\n              className=\"w-full text-left px-4 py-3 hover:bg-red-50 rounded-lg flex items-center gap-3 text-red-600 font-bold text-sm transition-colors mt-1\"\n            >\n              <Trash2 size={16} /> Eliminar SesiÃ³n\n            </button>\n          </div>\n        )}\n\n        <div className=\"flex justify-between mb-4 shrink-0 border-b border-slate-100 pb-4\">\n          <div>\n            <h2 className=\"text-xl font-bold flex items-center gap-2 text-slate-800\">\n              <Users className=\"text-pink-600\" />\n              {isScheduleMode ? 'Agendar SesiÃ³n Grupal' : 'BitÃ¡cora de SesiÃ³n Grupal'}\n            </h2>\n            <p className=\"text-sm text-slate-400\">\n              {isScheduleMode\n                ? 'Reserva de espacio y horario.'\n                : 'Registra asistencia y evoluciÃ³n cuantitativa del grupo'}\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            {/* CONFIG BUTTON */}\n            {/* DIRECT DELETE BUTTON (Requested: Discreet but Visible) */}\n            <button\n              type=\"button\"\n              onClick={async () => {\n                const sessionId = initialData?.id || initialData?.groupId;\n                // Pre-check\n                if (!sessionId) {\n                  if (confirm(\"Error: ID perdido. Â¿Recargar para intentar reparar?\")) window.location.reload();\n                  return;\n                }\n\n                if (confirm('âš ï¸ Â¿Eliminar Definitivamente este Grupo?\\n\\nSe borrarÃ¡ del calendario y del historial de todos los pacientes.')) {\n                  try {\n                    const { GroupSessionRepository } = await import('../../../data/repositories/GroupSessionRepository');\n                    await GroupSessionRepository.delete(String(sessionId));\n                    alert('Grupo Eliminado.');\n                    onClose();\n                    window.location.reload();\n                  } catch (e) {\n                    alert(\"Error: \" + e);\n                  }\n                }\n              }}\n              className=\"p-2 hover:bg-red-50 rounded-full transition-colors h-fit text-slate-300 hover:text-red-500 mr-1\"\n              title=\"Eliminar Grupo\"\n            >\n              <Trash2 size={20} />\n            </button>\n\n            {/* CONFIG BUTTON - FORCED */}\n            <button\n              onClick={() => setShowConfigMenu(!showConfigMenu)}\n              className={`flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all ${showConfigMenu ? 'bg-slate-100 text-slate-900' : 'bg-white border border-slate-200 text-slate-600 hover:bg-slate-50'}`}\n            >\n              <Settings size={16} />\n              Configurar\n            </button>\n            <button onClick={onClose} className=\"p-2 hover:bg-slate-100 rounded-full transition-colors h-fit text-slate-400 hover:text-slate-600\">\n              <X size={24} />\n            </button>\n          </div>\n        </div>\n\n        <form\n          className=\"flex-1 overflow-y-auto pr-2\"\n          onSubmit={async (e) => {\n            e.preventDefault();\n            try {\n              const formData = new FormData(e.target as HTMLFormElement);\n              if (!groupName?.trim()) {\n                alert(\"Es obligatorio el Nombre del Grupo.\");\n                return;\n              }\n\n              const sessionData: GroupSession = {\n                id: initialData?.id || crypto.randomUUID(),\n                date: date, // Use state variable\n                time: formData.get('time') as string,\n                phase: Number(formData.get('phase')) || 1,\n                activities: ['DinÃ¡mica'], // Default or derive from form\n                location: formData.get('location') as string,\n                type: 'group',\n                participantNames: participants.map(p => p.name),\n                price: sessionPrice, // Use state variable\n                paid: false, // Default\n                groupName: groupName.trim(), // Use state variable\n                methodology: formData.get('methodology') as string || '',\n                observations: formData.get('observations') as string || '',\n                engagementScore: engagementScore,\n                cohesionScore: cohesionScore,\n                energyLevel: energyLevel\n              };\n\n              if (!sessionData.time || !sessionData.location) {\n                alert(\"Por favor completa hora y lugar\");\n                return;\n              }\n\n              // Await the save to catch async errors from App.tsx/Repositories\n              const res = onSave(sessionData);\n              if (res instanceof Promise) await res;\n\n            } catch (err) {\n              console.error(\"ERROR AL GUARDAR GRUPO:\", err);\n              alert(\"Error al guardar sesiÃ³n: \" + (err instanceof Error ? err.message : String(err)));\n            }\n          }}\n        >\n          <div className={`grid grid-cols-1 ${isScheduleMode ? 'gap-4' : 'lg:grid-cols-12 gap-8'}`}>\n\n            {/* LEFT: Context & Participants */}\n            <div className={`${isScheduleMode ? 'col-span-1' : 'lg:col-span-4 border-r border-slate-100 pr-4'} space-y-6`}>\n              <div>\n                <label className=\"label-pro text-pink-600\">Nombre del Grupo</label>\n                <input\n                  id=\"groupNameInput\"\n                  value={groupName}\n                  onChange={(e) => setGroupName(e.target.value)}\n                  className=\"input-pro font-black text-lg text-slate-800 border-pink-200 focus:border-pink-500 bg-pink-50/30\"\n                  placeholder=\"Ej: Taller Memoria\"\n                  required\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"label-pro\">Fecha</label>\n                  <input type=\"date\" value={date} onChange={(e) => setDate(e.target.value)} className=\"input-pro\" required />\n                </div>\n                <div>\n                  <label className=\"label-pro\">Hora</label>\n                  <input type=\"time\" name=\"time\" defaultValue={initialData?.time || \"10:00\"} className=\"input-pro\" required />\n                </div>\n              </div>\n              <div>\n                <label className=\"label-pro\">UbicaciÃ³n</label>\n                <input name=\"location\" defaultValue={initialData?.location} className=\"input-pro\" placeholder=\"Sala...\" required />\n              </div>\n\n              {!isScheduleMode && (\n                <div>\n                  <label className=\"label-pro\">Fase del Grupo (Global)</label>\n                  <select name=\"phase\" className=\"input-pro\" defaultValue={initialData?.phase || 1}>\n                    <option value=\"1\">Fase 1: VinculaciÃ³n (1-5)</option>\n                    <option value=\"2\">Fase 2: ActivaciÃ³n (6-10)</option>\n                    <option value=\"3\">Fase 3: ExpresiÃ³n (11-15)</option>\n                    <option value=\"4\">Fase 4: IntegraciÃ³n (16-20)</option>\n                    <option value=\"5\">Fase 5: Cierre (+21)</option>\n                  </select>\n                </div>\n              )}\n\n              {/* ACTIVITIES & METHODOLOGY */}\n\n              {!isScheduleMode && (\n                <>\n                  <div className=\"bg-slate-50 p-4 rounded-xl border border-slate-100\">\n                    <label className=\"label-pro mb-2 block flex justify-between\">\n                      <span>Asistentes</span>\n                      <span className=\"text-slate-400 font-normal\">{participants.length}</span>\n                    </label>\n\n                    {/* SELECTION BAR */}\n                    <div className=\"flex gap-2 mb-3\">\n                      <select\n                        className=\"input-pro flex-1 text-sm\"\n                        value={selectedPatientId}\n                        onChange={(e) => {\n                          setSelectedPatientId(e.target.value);\n                          setGuestName('');\n                        }}\n                      >\n                        <option value=\"\">-- Seleccionar Paciente --</option>\n                        {patients.map(p => (\n                          <option key={p.id} value={p.id}>{p.name}</option>\n                        ))}\n                      </select>\n\n                      <span className=\"text-slate-300 py-2 font-bold text-xs self-center\">O</span>\n\n                      <input\n                        className=\"input-pro flex-1 text-sm bg-white\"\n                        placeholder=\"Nombre Invitado...\"\n                        value={guestName}\n                        onChange={(e) => {\n                          setGuestName(e.target.value);\n                          setSelectedPatientId('');\n                        }}\n                        onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddParticipant())}\n                      />\n\n                      <Button type=\"button\" onClick={handleAddParticipant} icon={Plus} size=\"sm\"\n                        disabled={!selectedPatientId && !guestName.trim()}\n                      >\n                        AÃ±adir\n                      </Button>\n                    </div>\n\n                    {/* LIST */}\n                    <div className=\"flex flex-wrap gap-2 max-h-[150px] overflow-y-auto content-start\">\n                      {participants.map((p, i) => (\n                        <span key={i} className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold shadow-sm ${p.id\n                          ? 'bg-pink-100 text-pink-700 border border-pink-200' // Real Patient\n                          : 'bg-slate-100 text-slate-500 border border-slate-200' // Guest\n                          }`}>\n                          {p.id && <Users size={10} />}\n                          {p.name}\n                          <button type=\"button\" onClick={() => handleRemoveParticipant(i)} className=\"hover:text-red-500 ml-1 opacity-60 hover:opacity-100\"><X size={12} /></button>\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n\n                  <div className=\"mt-4 pt-4 border-t border-slate-200 flex items-center justify-between\">\n                    <span className=\"text-xs font-bold text-slate-500\">RecaudaciÃ³n Total:</span>\n                    <div className=\"flex items-center gap-1\">\n                      <input\n                        type=\"number\"\n                        value={sessionPrice}\n                        onChange={(e) => setSessionPrice(Number(e.target.value))}\n                        className=\"w-20 text-right font-black bg-white border border-slate-200 rounded px-2 py-1 text-sm focus:ring-2 ring-pink-500 outline-none\"\n                      />\n                      <span className=\"font-bold text-slate-600\">â‚¬</span>\n                    </div>\n                  </div>\n                </>\n              )}\n            </div>\n\n            {/* RIGHT: Evolution & Metrics (HIDDEN IN SCHEDULE MODE) */}\n            {!isScheduleMode && (\n              <div className=\"lg:col-span-8 space-y-6 pl-4\">\n\n                {/* METRICS PANEL */}\n                <div className=\"bg-gradient-to-r from-slate-50 to-white p-5 rounded-2xl border border-slate-200 grid grid-cols-1 md:grid-cols-3 gap-6 shadow-sm\">\n                  {/* Engagement */}\n                  <div className=\"text-center space-y-3\">\n                    <div className=\"flex items-center justify-center gap-2 text-slate-600 font-bold text-sm\">\n                      <Activity size={16} className=\"text-blue-500\" /> ParticipaciÃ³n\n                    </div>\n                    <div className=\"relative pt-1\">\n                      <input\n                        type=\"range\" min=\"0\" max=\"10\" step=\"1\"\n                        value={engagementScore}\n                        onChange={(e) => setEngagementScore(Number(e.target.value))}\n                        className=\"w-full accent-blue-500 cursor-pointer\"\n                      />\n                      <div className=\"flex justify-between text-[10px] text-slate-400 uppercase font-bold mt-1\">\n                        <span>Baja</span>\n                        <span className=\"text-lg text-blue-600\">{engagementScore}</span>\n                        <span>Alta</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Cohesion */}\n                  <div className=\"text-center space-y-3\">\n                    <div className=\"flex items-center justify-center gap-2 text-slate-600 font-bold text-sm\">\n                      <Heart size={16} className=\"text-pink-500\" /> CohesiÃ³n\n                    </div>\n                    <div className=\"relative pt-1\">\n                      <input\n                        type=\"range\" min=\"0\" max=\"10\" step=\"1\"\n                        value={cohesionScore}\n                        onChange={(e) => setCohesionScore(Number(e.target.value))}\n                        className=\"w-full accent-pink-500 cursor-pointer\"\n                      />\n                      <div className=\"flex justify-between text-[10px] text-slate-400 uppercase font-bold mt-1\">\n                        <span>Disperso</span>\n                        <span className=\"text-lg text-pink-600\">{cohesionScore}</span>\n                        <span>Unido</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Energy */}\n                  <div className=\"text-center space-y-3\">\n                    <div className=\"flex items-center justify-center gap-2 text-slate-600 font-bold text-sm\">\n                      <Zap size={16} className=\"text-amber-500\" /> EnergÃ­a\n                    </div>\n                    <div className=\"flex justify-center gap-1\">\n                      {['Low', 'Medium', 'High'].map((level) => (\n                        <button\n                          key={level}\n                          type=\"button\"\n                          onClick={() => setEnergyLevel(level as 'High' | 'Medium' | 'Low')}\n                          className={`px-3 py-1 text-xs font-bold rounded-lg border transition-all ${energyLevel === level\n                            ? (level === 'High' ? 'bg-amber-100 border-amber-300 text-amber-700' : level === 'Medium' ? 'bg-slate-100 border-slate-300 text-slate-700' : 'bg-slate-50 border-slate-200 text-slate-400')\n                            : 'bg-white border-slate-100 text-slate-400 hover:border-slate-300'\n                            } ${energyLevel === level ? 'ring-2 ring-offset-1 ring-amber-100' : ''}`}\n                        >\n                          {level === 'Low' ? 'Baja' : level === 'Medium' ? 'Media' : 'Alta'}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"label-pro\">MetodologÃ­a / Actividad Principal</label>\n                  <textarea\n                    name=\"methodology\"\n                    defaultValue={initialData?.methodology}\n                    className=\"input-pro h-20 resize-none\"\n                    placeholder=\"Â¿QuÃ© se trabajÃ³ hoy? (Ej: Reminiscencia con fotos antiguas...)\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"label-pro flex justify-between\">\n                    <span>EvoluciÃ³n Cualitativa</span>\n                    <span className=\"text-xs font-normal text-slate-400\">Detalles clÃ­nicos y observaciones</span>\n                  </label>\n                  <textarea\n                    name=\"observations\"\n                    defaultValue={initialData?.observations}\n                    className=\"input-pro h-32 resize-none bg-yellow-50/50 border-yellow-200 focus:border-yellow-400 focus:ring-yellow-200\"\n                    placeholder=\"Describe la dinÃ¡mica, hitos alcanzados y anÃ©cdotas relevantes...\"\n                  />\n                </div>\n\n              </div>\n            )}\n          </div>\n          <div className=\"flex justify-end mt-6 gap-2 pt-4 border-t border-slate-100 shrink-0\">\n            <Button variant=\"ghost\" onClick={onClose} type=\"button\">\n              Cancelar\n            </Button>\n            <Button type=\"submit\">\n              {isScheduleMode ? 'Agendar Cita' : 'Guardar EvoluciÃ³n'}\n            </Button>\n          </div>\n        </form>\n      </div>\n    </div >\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\sessions\\modals\\QuickAppointmentModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\settings\\AuditView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\settings\\SettingsView.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [formData, settings]","fix":{"range":[1063,1073],"text":"[formData, settings]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":301,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":31}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\features\\settings\\SettingsView.tsx:24:7\n  22 |     if (settings && !formData) { // Only set if formData is empty\n  23 |       // eslint-disable-next-line react-hooks/set-state-in-effect\n> 24 |       setFormData(settings);\n     |       ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |\n  26 |     }\n  27 |   }, [settings]); // Remove formData dependency to run once or on settings change","line":24,"column":7,"nodeType":null,"endLine":24,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card } from '../../components/ui/Card';\nimport { Button } from '../../components/ui/Button';\nimport { Save, Building, CreditCard, Shield, Bell, Loader2 } from 'lucide-react';\nimport { ClinicSettings } from '../../lib/types';\nimport { useAuth } from '../../context/AuthContext';\nimport { useNavigate } from 'react-router-dom';\nimport { useSettingsController } from '../../hooks/controllers/useSettingsController';\n\nexport const SettingsView: React.FC = () => {\n  const { role, login } = useAuth();\n  const navigate = useNavigate();\n\n  // TITANIUM CONTROLLER\n  const { settings, isLoading, isUpdating, updateSettings } = useSettingsController();\n\n  // Local form state initialized from fetched settings\n  const [formData, setFormData] = useState<Partial<ClinicSettings>>({});\n\n  // Sync form when settings load\n  useEffect(() => {\n    if (settings && !formData) { // Only set if formData is empty\n      // eslint-disable-next-line react-hooks/set-state-in-effect\n      setFormData(settings);\n\n    }\n  }, [settings]); // Remove formData dependency to run once or on settings change\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await updateSettings(formData);\n      // Toast handled globally or locally if we added it back.\n      // For now, simple alert or relying on optimistic/log\n      // alert('Guardado Titanium!'); \n    } catch (err) {\n      console.error(\"Failed to save\", err);\n      alert(\"Error al guardar configuraciÃ³n.\");\n    }\n  };\n\n  if (isLoading) return (\n    <div className=\"flex h-96 items-center justify-center\">\n      <Loader2 className=\"animate-spin text-slate-400\" size={32} />\n    </div>\n  );\n\n  return (\n    <div className=\"max-w-4xl mx-auto animate-in fade-in space-y-6\">\n      <header className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-black text-slate-900 tracking-tight\">\n            ConfiguraciÃ³n ClÃ­nica\n          </h1>\n          <p className=\"text-slate-500 mt-1\">Datos de facturaciÃ³n y perfil profesional (Titanium Powered)</p>\n        </div>\n      </header>\n\n      <form onSubmit={handleSubmit}>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* General Info */}\n          <Card className=\"p-8 space-y-6\">\n            <h3 className=\"font-bold text-slate-800 flex items-center gap-2 border-b border-slate-100 pb-4\">\n              <Building size={20} className=\"text-pink-600\" /> InformaciÃ³n General\n            </h3>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <label className=\"label-pro\">Nombre de la ClÃ­nica / Profesional</label>\n                <input\n                  required\n                  className=\"input-pro\"\n                  value={formData.name || ''}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Ej: Centro de Musicoterapia Activa\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"label-pro\">DirecciÃ³n Fiscal</label>\n                <textarea\n                  className=\"input-pro min-h-[80px]\"\n                  value={formData.address || ''}\n                  onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                  placeholder=\"Calle, Ciudad, CÃ³digo Postal...\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"label-pro\">TelÃ©fono de Contacto</label>\n                <input\n                  className=\"input-pro\"\n                  value={formData.phone || ''}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"+34 600 000 000\"\n                />\n              </div>\n            </div>\n\n            <div className=\"pt-6 border-t border-slate-100\">\n              <h4 className=\"font-bold text-slate-800 mb-3 text-sm uppercase tracking-wide\">\n                GestiÃ³n de Datos\n              </h4>\n              <p className=\"text-xs text-slate-500 mb-4\">\n                Descarga una copia completa de tu base de datos en formato Excel/CSV.\n              </p>\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                className=\"w-full\"\n                onClick={() => {\n                  alert('Iniciando exportaciÃ³n masiva...');\n                  const dummyData = 'Nombre,Edad,DiagnÃ³stico\\nJuan,30,Stress\\nAna,25,Ansiedad';\n                  const bom = '\\uFEFF';\n                  const blob = new Blob([bom + dummyData], { type: 'text/csv;charset=utf-8;' });\n                  const url = URL.createObjectURL(blob);\n                  const link = document.createElement('a');\n                  link.href = url;\n                  link.setAttribute(\n                    'download',\n                    `Pacientes_Activa_${new Date().toISOString().slice(0, 10)}.csv`,\n                  );\n                  document.body.appendChild(link);\n                  link.click();\n                  document.body.removeChild(link);\n                }}\n                icon={Save}\n              >\n                Exportar Base de Datos (CSV)\n              </Button>\n            </div>\n          </Card>\n\n\n\n          {/* Legal & Invoice Data (Billing Object) */}\n          <div className=\"space-y-6\">\n            <Card className=\"p-8 space-y-6\">\n              <h3 className=\"font-bold text-slate-800 flex items-center gap-2 border-b border-slate-100 pb-4\">\n                <CreditCard size={20} className=\"text-indigo-600\" /> Datos de FacturaciÃ³n (PDF)\n              </h3>\n\n              {/* Logo Uploader */}\n              <div className=\"flex flex-col items-center p-6 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50 hover:bg-slate-50 transition-colors\">\n                {formData.billing?.logoUrl ? (\n                  <div className=\"relative group\">\n                    <img\n                      src={formData.billing.logoUrl}\n                      alt=\"Logo Factura\"\n                      className=\"w-24 h-24 rounded-full object-cover shadow-lg border-4 border-white\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setFormData({\n                        ...formData,\n                        billing: { ...formData.billing!, logoUrl: '' }\n                      })}\n                      className=\"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm\"\n                    >\n                      <Shield size={12} className=\"rotate-45\" /> {/* X icon replacement */}\n                    </button>\n                  </div>\n                ) : (\n                  <div className=\"text-center space-y-2\">\n                    <div className=\"w-16 h-16 bg-indigo-100 text-indigo-500 rounded-full flex items-center justify-center mx-auto mb-2\">\n                      <Building size={24} />\n                    </div>\n                    <p className=\"text-sm font-medium text-slate-600\">Logo de la Empresa</p>\n                    <p className=\"text-xs text-slate-400\">Circular en el PDF (MÃ¡x 10MB - Auto-ajuste)</p>\n                    <label className=\"cursor-pointer\">\n                      <span className=\"text-xs font-bold text-indigo-600 hover:text-indigo-700 bg-indigo-50 px-3 py-1.5 rounded-full transition-colors\">\n                        Subir Logo\n                      </span>\n                      <input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        className=\"hidden\"\n                        onChange={(e) => {\n                          const file = e.target.files?.[0];\n                          if (file) {\n                            if (file.size > 10 * 1024 * 1024) { // 10MB Limit\n                              alert(\"El archivo es demasiado pesado (MÃ¡x 10MB). Por favor reduce su tamaÃ±o.\");\n                              return;\n                            }\n\n                            // Compression Logic\n                            const reader = new FileReader();\n                            reader.onload = (event) => {\n                              const img = new Image();\n                              img.onload = () => {\n                                const canvas = document.createElement('canvas');\n                                const MAX_WIDTH = 500;\n                                const MAX_HEIGHT = 500;\n                                let width = img.width;\n                                let height = img.height;\n\n                                if (width > height) {\n                                  if (width > MAX_WIDTH) {\n                                    height *= MAX_WIDTH / width;\n                                    width = MAX_WIDTH;\n                                  }\n                                } else {\n                                  if (height > MAX_HEIGHT) {\n                                    width *= MAX_HEIGHT / height;\n                                    height = MAX_HEIGHT;\n                                  }\n                                }\n\n                                canvas.width = width;\n                                canvas.height = height;\n                                const ctx = canvas.getContext('2d');\n                                ctx?.drawImage(img, 0, 0, width, height);\n\n                                // Compress to JPEG 0.7 to save space\n                                const dataUrl = canvas.toDataURL('image/jpeg', 0.7);\n\n                                setFormData({\n                                  ...formData,\n                                  billing: {\n                                    ...formData.billing,\n                                    logoUrl: dataUrl,\n                                    legalName: formData.billing?.legalName || '',\n                                    nif: formData.billing?.nif || '',\n                                    address: formData.billing?.address || ''\n                                  }\n                                });\n                              };\n                              img.src = event.target?.result as string;\n                            };\n                            reader.readAsDataURL(file);\n                          }\n                        }}\n                      />\n                    </label>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"label-pro\">RazÃ³n Social (Nombre Legal)</label>\n                  <input\n                    className=\"input-pro\"\n                    value={formData.billing?.legalName || ''}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      billing: {\n                        ...formData.billing,\n                        legalName: e.target.value,\n                        nif: formData.billing?.nif || '',\n                        address: formData.billing?.address || '',\n                        logoUrl: formData.billing?.logoUrl || ''\n                      }\n                    })}\n                    placeholder=\"Ej: Juan PÃ©rez S.L.\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"label-pro\">CIF / NIF</label>\n                  <input\n                    className=\"input-pro font-mono\"\n                    value={formData.billing?.nif || ''}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      billing: {\n                        ...formData.billing,\n                        nif: e.target.value,\n                        legalName: formData.billing?.legalName || '',\n                        address: formData.billing?.address || '',\n                        logoUrl: formData.billing?.logoUrl || ''\n                      }\n                    })}\n                    placeholder=\"B-12345678\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"label-pro\">DirecciÃ³n de FacturaciÃ³n</label>\n                  <textarea\n                    className=\"input-pro min-h-[60px]\"\n                    value={formData.billing?.address || ''}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      billing: {\n                        ...formData.billing,\n                        address: e.target.value,\n                        legalName: formData.billing?.legalName || '',\n                        nif: formData.billing?.nif || '',\n                        logoUrl: formData.billing?.logoUrl || ''\n                      }\n                    })}\n                    placeholder=\"DirecciÃ³n completa para la factura...\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end pt-4 border-t border-slate-100 mt-4\">\n                <Button\n                  type=\"button\"\n                  onClick={async () => {\n                    try {\n                      await updateSettings(formData);\n                      alert(\"Datos de FacturaciÃ³n y Logo guardados correctamente.\");\n                    } catch (e) {\n                      alert(\"Error al guardar.\");\n                    }\n                  }}\n                  isLoading={isUpdating}\n                  icon={Save}\n                  variant=\"secondary\"\n                  className=\"border-indigo-200 text-indigo-700 hover:bg-indigo-50\"\n                >\n                  Guardar ConfiguraciÃ³n Fiscal\n                </Button>\n              </div>\n            </Card>\n\n            <Card className=\"p-8 space-y-4 bg-slate-50 border-slate-200\">\n              <div className=\"space-y-2\">\n                <label className=\"label-pro\">Texto Legal (Pie de Factura)</label>\n                <textarea\n                  className=\"input-pro text-xs text-slate-500 min-h-[100px]\"\n                  value={formData.legalText || ''}\n                  onChange={(e) => setFormData({ ...formData, legalText: e.target.value })}\n                  placeholder=\"TÃ©rminos y condiciones legales...\"\n                />\n              </div>\n            </Card>\n          </div>\n\n          {/* SimulaciÃ³n de Roles (Dev Tool) */}\n          <Card className=\"p-8 space-y-6 md:col-span-2 border-dashed border-2 border-slate-300 bg-slate-50\">\n            <h3 className=\"font-bold text-slate-500 flex items-center gap-2 uppercase tracking-widest text-xs\">\n              <div className=\"w-2 h-2 rounded-full bg-slate-400 animate-pulse\" /> SimulaciÃ³n de\n              Roles (Dev Mode)\n            </h3>\n            <div className=\"flex gap-4 items-center\">\n              <p className=\"text-sm text-slate-600 flex-1\">\n                Alterna entre roles para verificar la \"SanitizaciÃ³n de Interfaz\" (ocultaciÃ³n de\n                precios y funciones destructivas).\n              </p>\n              <div className=\"flex bg-white rounded-lg p-1 border border-slate-200\">\n                <button\n                  type=\"button\"\n                  onClick={() => login('admin')}\n                  className={`px-4 py-2 text-sm font-bold rounded-md transition-all ${role === 'admin' ? 'bg-slate-800 text-white shadow-md' : 'text-slate-500 hover:text-slate-800'}`}\n                >\n                  Admin (DueÃ±o)\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => login('therapist')}\n                  className={`px-4 py-2 text-sm font-bold rounded-md transition-all ${role === 'therapist' ? 'bg-pink-600 text-white shadow-md' : 'text-slate-500 hover:text-slate-800'}`}\n                >\n                  Terapeuta (ClÃ­nico)\n                </button>\n              </div>\n            </div>\n\n            {/* Security & Audit (Feature 16) */}\n            <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 bg-slate-200 text-slate-600 rounded-lg\">\n                  <Shield size={20} />\n                </div>\n                <div>\n                  <h4 className=\"font-bold text-slate-700 text-sm\">Registro de AuditorÃ­a</h4>\n                  <p className=\"text-xs text-slate-500\">Log de accesos y cambios (HIPAA)</p>\n                </div>\n              </div>\n              <Button size=\"sm\" variant=\"secondary\" onClick={() => navigate('/audit')}>Ver Logs</Button>\n            </div>\n          </Card>\n\n          {/* Notificaciones (Feature 15) */}\n          <Card className=\"p-6\">\n            <h3 className=\"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2\">\n              <Bell size={20} className=\"text-pink-500\" /> Notificaciones\n            </h3>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-pink-100 text-pink-600 rounded-lg\">\n                    <Bell size={20} />\n                  </div>\n                  <div>\n                    <h4 className=\"font-bold text-slate-700 text-sm\">Notificaciones Push</h4>\n                    <p className=\"text-xs text-slate-500\">Avisos al mÃ³vil/escritorio</p>\n                  </div>\n                </div>\n                <label className=\"relative inline-flex items-center cursor-pointer\">\n                  <input type=\"checkbox\" className=\"sr-only peer\" />\n                  <div className=\"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600\"></div>\n                </label>\n              </div>\n            </div>\n          </Card>\n        </div>\n\n        <div className=\"mt-8 flex justify-end\">\n          <Button type=\"submit\" className=\"w-full md:w-auto px-8\" icon={Save} isLoading={isUpdating}>\n            Guardar Cambios\n          </Button>\n        </div>\n      </form>\n\n      {/* DANGER ZONE (GDPR - Delete Account) */}\n      <Card className=\"p-8 border-red-200 bg-red-50 mt-8\">\n        <h3 className=\"font-bold text-red-700 flex items-center gap-2 mb-4\">\n          <Shield size={20} /> Zona de Peligro\n        </h3>\n        <p className=\"text-sm text-red-600 mb-6\">\n          Estas acciones son destructivas y no se pueden deshacer.\n        </p>\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h4 className=\"font-bold text-red-800 text-sm\">Eliminar Cuenta</h4>\n            <p className=\"text-xs text-red-600\">Borrar todos mis datos y salir</p>\n          </div>\n          <Button\n            variant=\"secondary\"\n            className=\"border-red-200 text-red-700 hover:bg-red-100\"\n            onClick={() => {\n              if (window.confirm('Â¿ESTÃS SEGURO? Esto borrarÃ¡ tu cuenta y todos tus pacientes permanentemente.')) {\n                // In a real implementation this would call deleteUser(user)\n                alert('Por seguridad, contacta a soporte@activamusicoterapia.com para confirmar la baja definitiva GDPR.');\n              }\n            }}\n          >\n            Eliminar Cuenta\n          </Button>\n        </div>\n      </Card>\n\n      {/* LEGAL FOOTER */}\n      <div className=\"text-center text-xs text-slate-400 py-8 flex justify-center gap-6\">\n        <a href=\"https://activamusicoterapia.com/legal/terms\" target=\"_blank\" rel=\"noreferrer\" className=\"hover:text-slate-600 transition-colors\">TÃ©rminos de Servicio</a>\n        <a href=\"https://activamusicoterapia.com/legal/privacy\" target=\"_blank\" rel=\"noreferrer\" className=\"hover:text-slate-600 transition-colors\">PolÃ­tica de Privacidad</a>\n        <span>Â© 2026 Activa Musicoterapia</span>\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\useDocumentController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\useInvoiceController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\useNoteController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\usePatientController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\useReportController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\useSessionController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\controllers\\useSettingsController.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\useActivityLog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\useImageUpload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\useInstallPrompt.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\useLemonSqueezy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\hooks\\useScrollDirection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\layout\\AppLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\layout\\MobileBottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\layout\\SidebarAgenda.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\layout\\SidebarCalendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\PdfGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\clinicalUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\dateUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\dateUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":43,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { isValid, parseISO } from 'date-fns';\r\n\r\n/**\r\n * Safely parses any input into a Date object or null.\r\n * Prevents RangeError: Invalid time value crashes.\r\n */\r\nexport const parseSafeDate = (date: unknown): Date | null => {\r\n    if (date === null || date === undefined) return null;\r\n\r\n    // 1. If already a Date\r\n    if (date instanceof Date) {\r\n        return isValid(date) ? date : null;\r\n    }\r\n\r\n    // 2. If Timestamp (number)\r\n    if (typeof date === 'number') {\r\n        const d = new Date(date);\r\n        return isValid(d) ? d : null;\r\n    }\r\n\r\n    // 3. If String\r\n    if (typeof date === 'string') {\r\n        // 3a. Try ISO Standard\r\n        const iso = parseISO(date);\r\n        if (isValid(iso)) return iso;\r\n\r\n        // 3b. Try constructing (for other formats browsers support)\r\n        const d = new Date(date);\r\n        if (isValid(d)) return d;\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n/**\r\n * Formats a date safely, returning a fallback if invalid.\r\n */\r\nexport const formatDateSafe = (date: unknown, formatter: (d: Date) => string, fallback: string = ''): string => {\r\n    const d = parseSafeDate(date);\r\n    if (!d) return fallback;\r\n    try {\r\n        return formatter(d);\r\n    } catch (e) {\r\n        return fallback;\r\n    }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\exportUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\patientUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\pdfTemplates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\react-query.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\seeds.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\templates\\invoiceTemplate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\locales\\en.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\locales\\es.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\routes\\AppRoutes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\stores\\useUIStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Usuario\\.gemini\\antigravity\\scratch\\monorepo-crm-activa\\apps\\crm-client\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]